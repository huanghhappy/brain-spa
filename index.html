<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>è§£å£“æ²»ç™‚æ‰€ Brain SPA</title>
    <style>
        @font-face { font-family: 'GenSenRounded2TW'; src: url('500.otf') format('opentype'); font-weight: 500; font-display: swap; }
        @font-face { font-family: 'GenSenRounded2TW'; src: url('700.otf') format('opentype'); font-weight: 700; font-display: swap; }
        @font-face { font-family: 'GenSenRounded2TW'; src: url('900.otf') format('opentype'); font-weight: 900; font-display: swap; }

        :root {
            --bg-color: #FDF6E3; --primary: #FFB3BA; --secondary: #BAE1FF;
            --text-color: #555555; --card-bg: #FFFFFF;
        }

        * {
            box-sizing: border-box; font-family: 'GenSenRounded2TW', 'Noto Sans TC', sans-serif;
            margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent;
            touch-action: manipulation; /* é˜²æ­¢é›™æ“Šæ”¾å¤§å¹²æ“¾éŠæˆ² */
        }

        body {
            background-color: var(--bg-color); color: var(--text-color);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; min-height: 100dvh; 
            padding: 2.5vh 15px 1.5vh 15px; justify-content: space-between; overflow: hidden;
        }

        #main-screen-container {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: flex-start; padding-top: 1vh; width: 100%; max-width: 500px;
        }

        #main-screen { width: 100%; display: flex; flex-direction: column; align-items: center; }

        h1 { font-size: 24px; font-weight: 900; margin-bottom: 2.5vh; color: #333; text-align: center; }

        .severity-selector {
            background: var(--card-bg); padding: 15px; border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 3vh; text-align: center; width: 100%;
        }

        .severity-selector p { font-size: 14px; font-weight: 700; margin-bottom: 12px; }

        input[type=range] {
            -webkit-appearance: none; appearance: none; width: 100%; height: 12px; border-radius: 6px;
            background: #eee; outline: none; margin: 10px 0; border: none;
        }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 36px; height: 36px;
            cursor: pointer; background: var(--thumb-img) center/contain no-repeat;
            background-color: transparent; border: none; outline: none; box-shadow: none; transform: translateY(-2px);
        }

        .game-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; }

        .game-btn {
            background-color: var(--card-bg); border: none; border-radius: 12px;
            padding: clamp(12px, 2vh, 18px) 5px; font-size: 14px; font-weight: 700;
            color: var(--text-color); cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.1s; display: flex; flex-direction: row;
            align-items: center; justify-content: center; gap: 6px; white-space: nowrap;
        }
        .game-btn:active { transform: scale(0.95); }
        .game-btn .icon { font-size: 18px; }

        footer { margin-top: auto; font-size: 11px; font-weight: 500; color: #aaaaaa; text-align: center; }

        #game-screen {
            display: none; flex: 1; flex-direction: column; align-items: center;
            width: 100%; max-width: 500px; justify-content: center; position: relative;
        }

        .back-btn {
            position: absolute; top: 0; left: 0; background: var(--primary); color: white;
            border: none; padding: 8px 15px; border-radius: 20px; font-size: 14px;
            font-weight: 700; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 179, 186, 0.4); z-index: 10;
        }

        .game-container {
            width: 100%; flex: 1; max-height: 70vh; display: flex; justify-content: center;
            align-items: center; background: var(--card-bg); border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; position: relative;
            margin-top: 45px; margin-bottom: 20px; flex-direction: column;
        }

        /* --- å‰äº”å€‹éŠæˆ² CSS (ç¶­æŒå®Œç¾) --- */
        .puzzle-board { width: 200px; height: 200px; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; background: #eee; border: 4px solid #ddd; border-radius: 10px; margin-bottom: 20px; position: relative; }
        .puzzle-slot { width: 100%; height: 100%; background: #fafafa; border-radius: 4px; }
        .puzzle-piece { width: 96px; height: 96px; position: absolute; border-radius: 4px; background-size: 200px 200px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.2s; z-index: 2; cursor: pointer; }
        .puzzle-piece.snapped { box-shadow: none; z-index: 1; pointer-events: none; }

        .bubble-wrap { display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; padding: 10px; }
        .bubble { width: 35px; height: 35px; background: radial-gradient(circle at 30% 30%, #ffffff, #BAE1FF); border-radius: 50%; box-shadow: inset 0 -2px 5px rgba(0,0,0,0.1), 0 2px 5px rgba(0,0,0,0.2); cursor: pointer; }
        .bubble.popped { background: #e0f0ff; box-shadow: inset 0 2px 5px rgba(0,0,0,0.1); transform: scale(0.9); }

        .pencil-stage { display: flex; align-items: flex-end; gap: 10px; height: 220px; border-bottom: 5px solid #eee; padding-bottom: 10px; }
        .pencil { width: 30px; border-radius: 3px 3px 0 0; position: relative; cursor: pointer; transition: height 0.1s; display: flex; justify-content: center; box-shadow: inset -5px 0 10px rgba(0,0,0,0.1); }
        .pencil::after { content: ''; position: absolute; top: 0; left: 0; width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 25px solid #FFDFBA; transform: translateY(-100%); z-index: 1;}
        .pencil::before { content: ''; position: absolute; top: -25px; left: 7.5px; width: 0; height: 0; border-left: 7.5px solid transparent; border-right: 7.5px solid transparent; border-bottom: 12px solid var(--pen-color); z-index: 2; }

        .color-stage { display: flex; flex-direction: column; gap: 6px; width: 80%; }
        .color-block { height: 35px; border-radius: 10px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .color-block.selected { transform: scale(0.95); box-shadow: inset 0 4px 6px rgba(0,0,0,0.2); border: 3px solid #333; }

        .head-wrapper { width: 240px; height: 260px; position: relative; margin-bottom: 10px; }
        .face-container { width: 100%; height: 100%; border-radius: 50% 50% 45% 45%; box-shadow: inset -15px -20px 40px rgba(0,0,0,0.15), inset 10px 10px 20px rgba(255,255,255,0.4), 0 10px 20px rgba(0,0,0,0.05); position: absolute; top: 0; left: 0; overflow: hidden; transition: background 0.3s; z-index: 2; }
        .ear { position: absolute; width: 45px; height: 60px; border-radius: 50%; top: 40%; z-index: 1; transition: background 0.3s; box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1), inset 5px 5px 10px rgba(255,255,255,0.3); }
        .ear.left { left: -20px; transform: rotate(-15deg); }
        .ear.right { right: -20px; transform: rotate(15deg); }
        .face-eyes { position: absolute; top: 42%; width: 100%; display: flex; justify-content: center; gap: 40px; pointer-events: none; }
        .eye { width: 16px; height: 16px; border-radius: 50%; background: radial-gradient(circle at 35% 35%, #555, #111); box-shadow: inset 2px 2px 4px rgba(0,0,0,0.5), 0 2px 4px rgba(255,255,255,0.4); }
        .face-blush { position: absolute; top: 48%; width: 100%; display: flex; justify-content: center; gap: 60px; pointer-events: none; }
        .blush { width: 25px; height: 15px; border-radius: 50%; opacity: 0.6; filter: blur(2px); transition: background 0.3s; }
        .face-nose { position: absolute; top: 52%; left: 50%; transform: translateX(-50%); width: 22px; height: 14px; border-radius: 50%; filter: brightness(0.95); pointer-events: none; box-shadow: -2px 3px 5px rgba(0,0,0,0.15), inset 2px 2px 5px rgba(255,255,255,0.5); transition: background 0.3s; }
        .face-mouth { position: absolute; top: 64%; left: 50%; transform: translateX(-50%); width: 18px; height: 20px; background: #6A040F; border-radius: 10px 10px 20px 20px; overflow: hidden; pointer-events: none; box-shadow: inset 0 4px 5px rgba(0,0,0,0.4); }
        .face-mouth::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 14px; height: 10px; background: #FF8C8C; border-radius: 10px 10px 0 0; }
        .pimple { position: absolute; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: transform 0.1s; z-index: 10; }
        .pimple-core { width: 30%; height: 30%; background: #FFFACD; border-radius: 50%; opacity: 0.9; }

        /* --- 6. è²“å’ªæ­¸ä½ (ä¹å®®æ ¼ç‰ˆ) --- */
        .cat-stage { width: 100%; height: 320px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
        .cat-box-grid { 
            width: 200px; height: 200px; background: #E6C280; border: 8px solid #C79A47; border-radius: 12px;
            display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 4px; padding: 4px;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.2), 0 10px 15px rgba(0,0,0,0.05); margin-bottom: 20px;
        }
        .cat-slot { 
            background: rgba(0,0,0,0.05); border-radius: 8px; display: flex; justify-content: center; align-items: center; position: relative;
        }
        .cat-silhouette { width: 85%; height: 85%; object-fit: contain; filter: brightness(0) opacity(0.2); pointer-events: none; }
        .cat-scatter-area { position: absolute; bottom: 0; width: 100%; height: 100px; }
        .draggable-cat { 
            width: 55px; height: 55px; object-fit: contain; position: absolute; cursor: grab; z-index: 10;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); transition: transform 0.1s;
        }
        .draggable-cat.snapped { 
            position: absolute !important; width: 85% !important; height: 85% !important; left: 7.5% !important; top: 7.5% !important; 
            transform: none !important; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); z-index: 2; pointer-events: none;
        }
        /* é¿å…åœ–æª”é‚„æ²’ä¸Šå‚³æ™‚ç ´åœ–ï¼Œçµ¦å€‹åº•è‰²é å‚™ */
        .fallback-cat { background: #FFB3BA; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; }

        /* --- 7. æ’•é™¤æ¨™ç±¤ (è²¨æ¶ç‰ˆ) --- */
        .shelves-container { width: 90%; height: 320px; display: flex; flex-direction: column; justify-content: space-evenly; }
        .shelf { width: 100%; height: 80px; border-bottom: 8px solid #D2B48C; display: flex; align-items: flex-end; justify-content: space-around; padding-bottom: 2px; position: relative; }
        .shelf::after { content: ''; position: absolute; bottom: -14px; left: 0; width: 100%; height: 6px; background: #A0522D; opacity: 0.3; }
        
        .shelf-item { position: relative; border-radius: 4px; display: flex; justify-content: center; align-items: center; flex-direction: column; box-shadow: inset -3px 0 8px rgba(0,0,0,0.15); }
        .item-type-1 { width: 35px; height: 60px; background: #FFB3BA; border-radius: 15px 15px 5px 5px; } /* ç“¶å­ */
        .item-type-2 { width: 45px; height: 45px; background: #BAE1FF; border-radius: 5px; } /* ç›’å­ */
        .item-type-3 { width: 30px; height: 70px; background: #BAFFC9; border-radius: 5px 5px 20px 20px; } /* é£²æ–™ç½ */
        
        .mini-sticker { 
            width: 20px; height: 16px; background: #FFF; position: absolute; z-index: 5; border-radius: 2px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.2); overflow: hidden; display: flex; justify-content: center; align-items: center; 
            /* è®“æ¨™ç±¤æ›´å®¹æ˜“è¢«è§¸æ§åˆ°ï¼Œæ“´å¤§æ„Ÿæ‡‰å€ */
            padding: 20px; background-clip: content-box; border: solid 10px transparent; margin: -10px;
        }
        .mini-barcode { width: 100%; height: 50%; background: repeating-linear-gradient(90deg, #333, #333 1px, transparent 1px, transparent 3px); opacity: 0.5; pointer-events: none; }
        /* æ’•é™¤å‹•ç•« */
        @keyframes peelOff { 
            0% { transform: translateY(0) rotate(0) scale(1); opacity: 1; }
            50% { transform: translateY(30px) rotate(15deg) scale(1.1); opacity: 0.8; }
            100% { transform: translateY(100px) rotate(45deg) scale(0.5); opacity: 0; }
        }
        .peeled { animation: peelOff 0.4s forwards; pointer-events: none; }

    </style>
</head>
<body>

    <div id="main-screen-container">
        <div id="main-screen">
            <h1>ğŸ§  è§£å£“æ²»ç™‚æ‰€ Brain SPA âœ¨</h1>
            <div class="severity-selector">
                <p>è«‹é¸æ“‡ä½ ç›®å‰çš„å¼·è¿«ç—‡ç™¼ä½œæŒ‡æ•¸</p>
                <input type="range" id="severity-slider" min="0" max="10" value="5">
                <div style="display: flex; justify-content: space-between; font-size: 11px; font-weight: 500; color: #aaa; margin-top: 5px;">
                    <span>å¾®ç„¦æ…®</span><span>å¿«çˆ†ç‚¸</span>
                </div>
            </div>

            <div class="game-grid">
                <button type="button" class="game-btn" onclick="startGame('puzzle')"><span class="icon">ğŸ§©</span> ç™‚ç™’æ‹¼åœ–</button>
                <button type="button" class="game-btn" onclick="startGame('bubble')"><span class="icon">ğŸ«§</span> ææ³¡æ³¡ç´™</button>
                <button type="button" class="game-btn" onclick="startGame('pencil')"><span class="icon">ğŸ–ï¸</span> é‰›ç­†å‰Šå¹³</button>
                <button type="button" class="game-btn" onclick="startGame('color')"><span class="icon">ğŸŒˆ</span> é¡è‰²æ’åº</button>
                <button type="button" class="game-btn" onclick="startGame('pimple')"><span class="icon">ğŸ’¥</span> æ“ çˆ†ç—˜ç—˜</button>
                <button type="button" class="game-btn" onclick="startGame('cat')"><span class="icon">ğŸ“¦</span> è²“å’ªæ­¸ä½</button>
                <button type="button" class="game-btn" onclick="startGame('peel')"><span class="icon">ğŸ©¹</span> æ’•é™¤æ¨™ç±¤</button>
                <button type="button" class="game-btn" onclick="alert('æ¡Œå¸ƒé™¤å¡µï¼šå³å°‡è§£é–ï¼')"><span class="icon">ğŸ§¹</span> æ¡Œå¸ƒé™¤å¡µ</button>
                <button type="button" class="game-btn" onclick="alert('ä¿„ç¾…æ–¯å¥—å¨ƒï¼šå³å°‡è§£é–ï¼')"><span class="icon">ğŸª†</span> ä¿„ç¾…æ–¯å¥—å¨ƒ</button>
                <button type="button" class="game-btn" onclick="alert('ç¢ç´™æ©Ÿï¼šå³å°‡è§£é–ï¼')"><span class="icon">ğŸ“„</span> ç¢ç´™æ©Ÿ</button>
            </div>
        </div>
    </div>

    <div id="game-screen">
        <button type="button" class="back-btn" onclick="showMainScreen()">ğŸ”™ è¿”å›æ²»ç™‚æ‰€</button>
        <div class="game-container" id="game-content"></div>
    </div>

    <footer>Â© 2026 an App a Day Project.</footer>

    <script>
        // ==========================================
        // ã€Web Audio API æ ¸å¿ƒã€‘çµ•å°é›¶å»¶é²éŸ³æ•ˆç³»çµ±
        // ==========================================
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        const audioBuffers = {};

        async function loadAudio(name, url) {
            try {
                const response = await fetch(url);
                const arrayBuffer = await response.arrayBuffer();
                const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
                audioBuffers[name] = audioBuffer;
            } catch (e) { console.log(`éŸ³æ•ˆ ${name} è¼‰å…¥å¤±æ•—`, e); }
        }

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
                loadAudio('pop', 'pop.mp3');
                loadAudio('shave', 'shave.mp3');
                loadAudio('pimple', 'pimple.mp3');
                loadAudio('cat', 'cat.mp3');
                loadAudio('peel', 'peel.mp3');
            }
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function wakeUpAudio() {
            if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
        }
        document.body.addEventListener('touchstart', wakeUpAudio, { capture: true, passive: true });
        document.body.addEventListener('click', wakeUpAudio, { capture: true, passive: true });

        function playSound(name) {
            if (!audioCtx || !audioBuffers[name]) return;
            wakeUpAudio(); 
            const source = audioCtx.createBufferSource();
            source.buffer = audioBuffers[name];
            source.connect(audioCtx.destination);
            source.start(0);
        }

        // ==========================================
        // UI èˆ‡è·¯ç”±é‚è¼¯
        // ==========================================
        const mainScreenContainer = document.getElementById('main-screen-container');
        const gameScreen = document.getElementById('game-screen');
        const gameContent = document.getElementById('game-content');
        
        const emojis = ['ğŸ«£', 'ğŸ˜–', 'ğŸ«¨', 'ğŸ˜µâ€ğŸ’«', 'ğŸ« ', 'ğŸ¥¶', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ˜µ', 'ğŸ¤¯', 'ğŸ’¥'];
        const slider = document.getElementById('severity-slider');

        function updateSliderEmoji() {
            const currentEmoji = emojis[parseInt(slider.value)];
            const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><text x="50%" y="50%" dominant-baseline="central" text-anchor="middle" font-size="30">${currentEmoji}</text></svg>`;
            slider.style.setProperty('--thumb-img', `url('data:image/svg+xml;utf8,${encodeURIComponent(svg)}')`);
        }
        slider.addEventListener('input', updateSliderEmoji);
        updateSliderEmoji();

        function startGame(gameId) {
            initAudio(); 
            mainScreenContainer.style.display = 'none';
            gameScreen.style.display = 'flex'; document.querySelector('footer').style.display = 'none';
            gameContent.innerHTML = ''; 
            
            if (gameId === 'puzzle') initPuzzleGame();
            if (gameId === 'bubble') initBubbleGame();
            if (gameId === 'pencil') initPencilGame();
            if (gameId === 'color') initColorGame();
            if (gameId === 'pimple') initPimpleGame();
            if (gameId === 'cat') initCatGame();
            if (gameId === 'peel') initPeelGame();
        }

        function showMainScreen() {
            gameScreen.style.display = 'none';
            mainScreenContainer.style.display = 'flex'; document.querySelector('footer').style.display = 'block';
        }

        // --- 1. ç™‚ç™’æ‹¼åœ– (å®Œç¾ä¸è®Š) ---
        const puzzlePatterns = [
            'linear-gradient(135deg, #FFB3BA, #BAE1FF)', 'linear-gradient(135deg, #FFDFBA, #FFFFBA)',
            'linear-gradient(135deg, #BAFFC9, #BAE1FF)', 'linear-gradient(135deg, #E0BBE4, #957DAD)',
            'linear-gradient(135deg, #D291BC, #FEC8D8)', 'linear-gradient(135deg, #FFC3A0, #FFAFBD)',
            'linear-gradient(135deg, #A18CD1, #FBC2EB)', 'linear-gradient(135deg, #84FAB0, #8FD3F4)',
            'linear-gradient(135deg, #FCCB90, #D57EEB)', 'linear-gradient(135deg, #F093FB, #F5576C)'
        ];
        let lastPuzzleIndex = -1;
        window.initPuzzleGame = function() {
            let nextIndex; do { nextIndex = Math.floor(Math.random() * puzzlePatterns.length); } while (nextIndex === lastPuzzleIndex); lastPuzzleIndex = nextIndex;
            let currentPattern = puzzlePatterns[nextIndex];
            gameContent.innerHTML = `<p style="margin-bottom:15px;font-weight:700;text-align:center;">å–®æ“Šå¯æ—‹è½‰ï¼Œä¸¦æ‹–æ›³åˆ°æ­£ç¢ºä½ç½®</p><div class="puzzle-board" id="p-board"><div class="puzzle-slot" id="slot-0"></div><div class="puzzle-slot" id="slot-1"></div><div class="puzzle-slot" id="slot-2"></div><div class="puzzle-slot" id="slot-3"></div></div><div id="pieces-container" style="position:relative; width:250px; height:120px;"></div><button type="button" onclick="initPuzzleGame()" style="margin-top:10px;padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ å†æ‹¼ä¸€çµ„</button>`;
            const pBoard = document.getElementById('p-board'); const pContainer = document.getElementById('pieces-container'); const positions = ['0 0', '-100px 0', '0 -100px', '-100px -100px']; let snappedCount = 0;
            for(let i=0; i<4; i++) {
                let piece = document.createElement('div'); piece.className = 'puzzle-piece'; piece.style.backgroundImage = currentPattern; piece.style.backgroundPosition = positions[i]; piece.dataset.id = i;
                let startX = Math.random() * 150; let startY = Math.random() * 20; let rot = Math.floor(Math.random() * 4) * 90;
                piece.dataset.rot = rot; piece.style.left = startX + 'px'; piece.style.top = startY + 'px'; piece.style.transform = `rotate(${rot}deg)`; pContainer.appendChild(piece);
                let isDragging = false, hasMoved = false, offsetX, offsetY;
                piece.addEventListener('touchstart', e => { isDragging = true; hasMoved = false; let touch = e.touches[0]; let rect = piece.getBoundingClientRect(); offsetX = touch.clientX - rect.left; offsetY = touch.clientY - rect.top; piece.style.zIndex = 10; });
                piece.addEventListener('touchmove', e => { if(!isDragging) return; hasMoved = true; let touch = e.touches[0]; piece.style.position = 'fixed'; piece.style.left = (touch.clientX - offsetX) + 'px'; piece.style.top = (touch.clientY - offsetY) + 'px'; e.preventDefault(); }, {passive: false});
                piece.addEventListener('touchend', e => {
                    isDragging = false; piece.style.zIndex = 2;
                    if(!hasMoved) { rot = (rot + 90) % 360; piece.dataset.rot = rot; piece.style.transform = `rotate(${rot}deg)`; return; }
                    let slot = document.getElementById('slot-' + i); let slotRect = slot.getBoundingClientRect(); let pieceRect = piece.getBoundingClientRect();
                    let dx = Math.abs(slotRect.left - pieceRect.left); let dy = Math.abs(slotRect.top - pieceRect.top);
                    if(dx < 30 && dy < 30 && rot === 0) { piece.classList.add('snapped'); piece.style.position = 'absolute'; piece.style.left = slot.offsetLeft + 'px'; piece.style.top = slot.offsetTop + 'px'; pBoard.appendChild(piece); snappedCount++; if(snappedCount === 4) setTimeout(() => alert('âœ¨ æ‹¼åœ–å®Œæˆï¼ç•«é¢å¤ªèˆ’æœäº†ï¼'), 300); }
                });
            }
        }

        // --- 2. ææ³¡æ³¡ç´™ (å®Œç¾ä¸è®Š) ---
        let poppedBubblesCount = 0;
        window.initBubbleGame = function() {
            poppedBubblesCount = 0; let html = `<div class="bubble-wrap">`;
            for(let i=0; i<36; i++) { html += `<div class="bubble" onclick="popBubble(this)"></div>`; }
            html += `</div>`;
            gameContent.innerHTML = `<p style="margin-bottom:15px;font-weight:700;">ç›¡æƒ…æçˆ†å®ƒå€‘å§ï¼</p>${html}<button type="button" onclick="initBubbleGame()" style="margin-top:15px;padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ æ›å¼µæ–°çš„</button>`;
        }
        window.popBubble = function(el) {
            if(!el.classList.contains('popped')) { el.classList.add('popped'); playSound('pop'); poppedBubblesCount++; if(poppedBubblesCount === 36) setTimeout(() => alert('âœ¨ æ³¡æ³¡å…¨æçˆ†äº†ï¼ç¥æ¸…æ°£çˆ½ï¼'), 300); }
        }

        // --- 3. é‰›ç­†å‰Šå¹³ (å®Œç¾ä¸è®Š) ---
        window.initPencilGame = function() {
            const colors = ['#FF6B6B', '#FFA06B', '#FFD166', '#06D6A0', '#118AB2', '#8338EC'];
            let heights = colors.map(() => Math.floor(Math.random() * 11 + 10) * 10); let targetHeight = Math.min(...heights);
            let html = `<p style="margin-bottom:20px;font-weight:700;">é»æ“Šéé•·çš„é‰›ç­†ï¼ŒæŠŠå®ƒå€‘å‰Šé½Šå¹³ï¼</p><div class="pencil-stage">`;
            colors.forEach((c, idx) => { html += `<div class="pencil" id="pen-${idx}" style="height:${heights[idx]}px; background:${c}; --pen-color:${c};" onclick="shavePen(${idx})"></div>`; });
            html += `</div><button type="button" onclick="initPencilGame()" style="margin-top:20px;padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ æ›ä¸€æŠŠç­†</button>`;
            gameContent.innerHTML = html;
            window.shavePen = function(idx) {
                const el = document.getElementById(`pen-${idx}`); let h = parseInt(el.style.height);
                if(h > targetHeight) { el.style.height = (h - 10) + 'px'; playSound('shave'); }
                let allEqual = true; for(let i=0; i<6; i++) { if(parseInt(document.getElementById(`pen-${i}`).style.height) !== targetHeight) { allEqual = false; break; } }
                if(allEqual) setTimeout(() => alert('âœ¨ å…¨éƒ¨ä¸€æ¨£å¹³äº†ï¼å¼·è¿«ç—‡æ²»ç™’ï¼'), 300);
            }
        }

        // --- 4. é¡è‰²æ’åº (å®Œç¾ä¸è®Š) ---
        const palettes = [['#732031', '#A12D45', '#D03958', '#E85B7A', '#EF8A9F', '#F4B3C0', '#F9D9DF', '#FDF1F3'], ['#03045E', '#023E8A', '#0077B6', '#0096C7', '#00B4D8', '#48CAE4', '#90E0EF', '#CAF0F8'], ['#081C15', '#1B4332', '#2D6A4F', '#40916C', '#52B788', '#74C69D', '#95D5B2', '#B7E4C7'], ['#370617', '#6A040F', '#9D0208', '#D00000', '#DC2F02', '#E85D04', '#F48C06', '#FAA307'], ['#10002B', '#240046', '#3C096C', '#5A189A', '#7B2CBF', '#9D4EDD', '#C77DFF', '#E0AAFF'], ['#38220F', '#463220', '#5E4835', '#7A624E', '#9C826B', '#C0A991', '#E2CFC0', '#F3E8E0'], ['#212529', '#343A40', '#495057', '#6C757D', '#ADB5BD', '#CED4DA', '#DEE2E6', '#F8F9FA'], ['#00211F', '#00423D', '#00625B', '#00837A', '#00A498', '#20C5B7', '#60D7CD', '#A0E9E3'], ['#4D3A00', '#806000', '#B38600', '#E6AC00', '#FFC300', '#FFD033', '#FFDD66', '#FFEA99'], ['#2E1E3B', '#4D3263', '#6B468A', '#8A5AB1', '#A972D3', '#BE92E0', '#D3B3ED', '#E8D4F6']];
        window.initColorGame = function() {
            let correctOrder = palettes[Math.floor(Math.random() * palettes.length)]; let currentOrder = [...correctOrder].sort(() => Math.random() - 0.5); 
            window.renderColorBlocks = () => {
                let html = `<div style="text-align:center; margin-bottom:25px;"><p style="font-weight:700; margin-bottom:15px;">é»æ“Šå…©å¡Šé¡è‰²ä¾†äº’ç›¸äº¤æ›ä½ç½®</p><p style="font-size:13px; color:#888;">è«‹å°‡é¡è‰²ç”±ä¸Šè€Œä¸‹ï¼Œä¾åºå¾ã€Œæœ€æ·±ã€æ’åˆ—åˆ°ã€Œæœ€æ·ºã€</p></div><div class="color-stage">`;
                currentOrder.forEach((color, idx) => { html += `<div class="color-block" style="background:${color}" onclick="selectColor(${idx})" id="cb-${idx}"></div>`; });
                html += `</div><button type="button" onclick="initColorGame()" style="margin-top:20px;padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ æ›ä¸€çµ„é¡è‰²</button>`; gameContent.innerHTML = html;
            };
            let selectedIdx = -1;
            window.selectColor = function(idx) {
                const block = document.getElementById(`cb-${idx}`);
                if(selectedIdx === -1) { selectedIdx = idx; block.classList.add('selected'); } 
                else {
                    let temp = currentOrder[selectedIdx]; currentOrder[selectedIdx] = currentOrder[idx]; currentOrder[idx] = temp; selectedIdx = -1; renderColorBlocks();
                    if(JSON.stringify(currentOrder) === JSON.stringify(correctOrder)) setTimeout(() => alert('âœ¨ æ¼¸å±¤å¥½å®Œç¾ï¼çœ¼ç›ç™‚ç™’äº†ï¼'), 300);
                }
            }
            renderColorBlocks();
        }

        // --- 5. æ“ çˆ†ç—˜ç—˜ (å®Œç¾ä¸è®Š) ---
        const faceConfigs = [{ bg: '#FFF5E1', blush: '#FFD1D1' }, { bg: '#FFE4C4', blush: '#FFB6C1' }, { bg: '#FCD5CE', blush: '#F08080' }, { bg: '#F8C8B5', blush: '#E9967A' }, { bg: '#EAC0A6', blush: '#CD853F' }, { bg: '#D2B48C', blush: '#A0522D' }, { bg: '#C68E63', blush: '#8B4513' }, { bg: '#A67B5B', blush: '#6B4226' }, { bg: '#8D5524', blush: '#5C3317' }, { bg: '#4B3621', blush: '#301F12' }];
        window.initPimpleGame = function() {
            let html = `<p style="margin-bottom:15px;font-weight:700;text-align:center;">é€£é»ç—˜ç—˜æŠŠå®ƒå€‘å…¨éƒ¨æ“ çˆ†ï¼</p><div class="head-wrapper"><div class="ear left" id="ear-l"></div><div class="ear right" id="ear-r"></div><div class="face-container" id="face-area"><div class="face-eyes"><div class="eye"></div><div class="eye"></div></div><div class="face-blush" id="face-blush"><div class="blush"></div><div class="blush"></div></div><div class="face-nose" id="face-nose"></div><div class="face-mouth"></div></div></div><button type="button" onclick="initPimpleGame()" style="margin-top:10px;padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ æ›å¼µè‡‰</button>`;
            gameContent.innerHTML = html;
            const face = document.getElementById('face-area'); const earL = document.getElementById('ear-l'); const earR = document.getElementById('ear-r'); const faceNose = document.getElementById('face-nose'); const blushLeft = document.getElementById('face-blush').children[0]; const blushRight = document.getElementById('face-blush').children[1];
            const config = faceConfigs[Math.floor(Math.random() * faceConfigs.length)]; face.style.background = config.bg; earL.style.background = config.bg; earR.style.background = config.bg; faceNose.style.background = config.bg; blushLeft.style.background = config.blush; blushRight.style.background = config.blush;
            const pimpleCount = Math.floor(Math.random() * 3) + 6; let poppedTotal = 0;
            for(let i=0; i<pimpleCount; i++) {
                let p = document.createElement('div'); let size = Math.random() * 20 + 20; p.className = 'pimple'; p.style.width = size + 'px'; p.style.height = size + 'px';
                let leftPos = Math.random() * 70 + 15; let topPos = Math.random() * 80 + 10; if(leftPos > 25 && leftPos < 75 && topPos > 35 && topPos < 70) topPos = topPos > 52 ? 75 : 15; 
                p.style.left = leftPos + '%'; p.style.top = topPos + '%'; let redHue = Math.random() > 0.5 ? '#FF8C8C' : '#FF4040'; p.style.background = `radial-gradient(circle at 30% 30%, ${redHue}, #B22222)`; p.style.boxShadow = `-3px 4px 8px rgba(0,0,0,0.2), inset 3px 3px 6px rgba(255,255,255,0.4)`;
                let core = document.createElement('div'); core.className = 'pimple-core'; p.appendChild(core); face.appendChild(p);
                let clicksNeeded = Math.floor(Math.random() * 11) + 10; let currentClicks = 0;
                p.addEventListener('touchstart', function(e) { e.preventDefault(); handlePimpleClick(); }, {passive: false}); p.addEventListener('mousedown', function(e) { e.preventDefault(); handlePimpleClick(); });
                function handlePimpleClick() {
                    if(currentClicks >= clicksNeeded) return; currentClicks++; p.style.transform = `scale(${1 + currentClicks * 0.05})`;
                    if(currentClicks === clicksNeeded) { playSound('pimple'); p.style.display = 'none'; poppedTotal++; if(poppedTotal === pimpleCount) setTimeout(() => alert('âœ¨æ¶ˆæ»…ç—˜ç—˜ï¼è‡‰è›‹è®Šå¹³æ»‘äº†ï¼'), 400); }
                }
            }
        }

        // --- 6. è²“å’ªæ­¸ä½ (ä¹å®®æ ¼ç‰ˆ) ---
        window.initCatGame = function() {
            gameContent.innerHTML = `
                <p style="margin-bottom:15px;font-weight:700;text-align:center;">å°‡æ•£è½çš„å°è²“æ‹–æ›³å›ç´™ç®±æ­£ç¢ºçš„ä½ç½®</p>
                <div class="cat-stage">
                    <div class="cat-box-grid" id="cat-box-grid">
                        </div>
                    <div class="cat-scatter-area" id="cats-container"></div>
                </div>
                <button type="button" onclick="initCatGame()" style="margin-top:10px;padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ å†æ”¶ä¸€ç®±</button>
            `;
            
            const grid = document.getElementById('cat-box-grid');
            const container = document.getElementById('cats-container');
            let snappedCount = 0;
            
            // ç”Ÿæˆéš¨æ©Ÿæ’åºçš„ 1~9 é™£åˆ—ï¼Œç”¨æ–¼æ‰“äº‚è²“å’ªå’Œæ ¼å­çš„å°æ‡‰é—œä¿‚
            let catIds = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);

            for(let i=0; i<9; i++) {
                const catId = catIds[i];

                // å»ºç«‹ä¹å®®æ ¼æ’æ§½èˆ‡å‰ªå½±
                let slot = document.createElement('div');
                slot.className = 'cat-slot';
                slot.id = 'cat-slot-' + catId;
                slot.innerHTML = `<img src="cat${catId}.png" class="cat-silhouette" onerror="this.outerHTML='<div class=\\'fallback-cat\\' style=\\'width:85%;height:85%;background:#ccc;\\'></div>'">`;
                grid.appendChild(slot);

                // å»ºç«‹æ•£è½çš„å°è²“
                let cat = document.createElement('img');
                cat.src = `cat${catId}.png`;
                cat.className = 'draggable-cat';
                cat.dataset.id = catId;
                cat.dataset.snapped = 'false'; // ç‹€æ…‹é–ï¼Œé˜²æ­¢é‡è¤‡æ’­æ”¾
                
                // æ‰¾ä¸åˆ°åœ–ç‰‡æ™‚çš„å‚™ç”¨é¡¯ç¤º
                cat.onerror = function() { this.outerHTML = `<div class='draggable-cat fallback-cat' data-id='${catId}' data-snapped='false' style='left:${this.style.left}; top:${this.style.top}; transform:${this.style.transform};'>ğŸ±</div>`; setTimeout(()=>attachCatEvents(document.querySelector(`.draggable-cat[data-id='${catId}']`)), 50); };

                // éš¨æ©Ÿæ•£è½ä½ç½® (è¢å¹•åº•éƒ¨å€åŸŸ)
                cat.style.left = (Math.random() * 200 + 10) + 'px';
                cat.style.top = (Math.random() * 60 + 10) + 'px';
                cat.style.transform = `rotate(${(Math.random() - 0.5) * 60}deg)`;
                
                container.appendChild(cat);
                attachCatEvents(cat);
            }

            function attachCatEvents(catElement) {
                if(!catElement) return;
                let isDragging = false, offsetX, offsetY;

                catElement.addEventListener('touchstart', e => {
                    if(catElement.dataset.snapped === 'true') return;
                    isDragging = true; let touch = e.touches[0];
                    let rect = catElement.getBoundingClientRect(); 
                    offsetX = touch.clientX - rect.left; offsetY = touch.clientY - rect.top; 
                    catElement.style.zIndex = 20;
                });

                catElement.addEventListener('touchmove', e => {
                    if(!isDragging) return; 
                    let touch = e.touches[0];
                    catElement.style.position = 'fixed'; 
                    catElement.style.left = (touch.clientX - offsetX) + 'px'; 
                    catElement.style.top = (touch.clientY - offsetY) + 'px'; 
                    e.preventDefault();
                }, {passive: false});

                catElement.addEventListener('touchend', e => {
                    if(!isDragging) return;
                    isDragging = false; catElement.style.zIndex = 10;
                    
                    let targetSlot = document.getElementById('cat-slot-' + catElement.dataset.id);
                    let slotRect = targetSlot.getBoundingClientRect(); 
                    let catRect = catElement.getBoundingClientRect();
                    
                    // åˆ¤æ–·æ˜¯å¦æ”¾åœ¨å°æ‡‰çš„æ ¼å­ä¸Š (å®¹éŒ¯ç‡ 30px)
                    let dx = Math.abs(slotRect.left - catRect.left);
                    let dy = Math.abs(slotRect.top - catRect.top);

                    if (dx < 30 && dy < 30) {
                        catElement.dataset.snapped = 'true'; // ä¸Šé–
                        catElement.classList.add('snapped');
                        targetSlot.appendChild(catElement);
                        playSound('cat'); // ç¢ºä¿åªæ’­æ”¾ä¸€æ¬¡
                        snappedCount++;
                        if(snappedCount === 9) setTimeout(() => alert('âœ¨ å°è²“éƒ½ä¹–ä¹–æ”¶é€²ç®±å­äº†ï¼'), 300);
                    }
                });
            }
        }

        // --- 7. æ’•é™¤æ¨™ç±¤ (è¶…å¸‚è²¨æ¶å¤§æƒé™¤) ---
        window.initPeelGame = function() {
            gameContent.innerHTML = `
                <p style="margin-bottom:10px;font-weight:700;text-align:center;">ç”±ä¸Šå¾€ä¸‹å¿«é€Ÿæ»‘å‹•ï¼Œæ’•ä¸‹æ‰€æœ‰ç¤™çœ¼æ¨™ç±¤ï¼</p>
                <div class="shelves-container" id="shelves">
                    </div>
                <button type="button" onclick="initPeelGame()" style="margin-top:10px;padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ æ›æ‰¹å•†å“</button>
            `;
            
            const shelvesContainer = document.getElementById('shelves');
            let totalStickers = 0;
            let peeledCount = 0;

            // ç”¢ç”Ÿ 3 æ’è²¨æ¶
            for(let row = 0; row < 3; row++) {
                let shelf = document.createElement('div');
                shelf.className = 'shelf';
                
                // æ¯æ’ 5 å€‹å•†å“
                for(let col = 0; col < 5; col++) {
                    let item = document.createElement('div');
                    let type = Math.floor(Math.random() * 3) + 1;
                    item.className = `shelf-item item-type-${type}`;
                    
                    // éš¨æ©Ÿé¡è‰²
                    const itemColors = ['#FFB3BA', '#BAE1FF', '#BAFFC9', '#FFFFBA', '#E0BBE4', '#FFDFBA'];
                    item.style.background = itemColors[Math.floor(Math.random() * itemColors.length)];

                    // æ¯å€‹å•†å“è²¼ 1~2 å¼µæ¨™ç±¤
                    let stickerNum = Math.floor(Math.random() * 2) + 1;
                    for(let s = 0; s < stickerNum; s++) {
                        let sticker = document.createElement('div');
                        sticker.className = 'mini-sticker';
                        sticker.innerHTML = '<div class="mini-barcode"></div>';
                        
                        // éš¨æ©Ÿè²¼çš„ä½ç½®
                        sticker.style.top = (Math.random() * 40) + '%';
                        sticker.style.left = (Math.random() * 40 + 10) + '%';
                        sticker.style.transform = `rotate(${(Math.random() - 0.5) * 20}deg)`;
                        sticker.dataset.peeled = 'false'; // ç‹€æ…‹é–

                        // æ”¯æ´è§¸æ§æ»‘å‹•æ’•ä¸‹
                        sticker.addEventListener('touchmove', function(e) {
                            if(this.dataset.peeled === 'true') return;
                            e.preventDefault(); // é˜²æ­¢æ»¾å‹•è¢å¹•
                            
                            this.dataset.peeled = 'true'; // é–å®š
                            this.classList.add('peeled');
                            playSound('peel');
                            
                            peeledCount++;
                            if(peeledCount === totalStickers) {
                                setTimeout(() => alert('âœ¨ è¼•é¬†æ’•å¾—ä¹¾æ·¨æºœæºœï¼'), 400);
                            }
                        }, {passive: false});

                        item.appendChild(sticker);
                        totalStickers++;
                    }
                    shelf.appendChild(item);
                }
                shelvesContainer.appendChild(shelf);
            }
        }
    </script>
</body>
</html>
