<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>è§£å£“æ²»ç™‚æ‰€ Brain SPA</title>
    <style>
        @font-face { font-family: 'GenSenRounded2TW'; src: url('500.otf') format('opentype'); font-weight: 500; font-display: swap; }
        @font-face { font-family: 'GenSenRounded2TW'; src: url('700.otf') format('opentype'); font-weight: 700; font-display: swap; }
        @font-face { font-family: 'GenSenRounded2TW'; src: url('900.otf') format('opentype'); font-weight: 900; font-display: swap; }

        :root {
            --bg-color: #FDF6E3; --primary: #FFB3BA; --secondary: #BAE1FF;
            --text-color: #555555; --card-bg: #FFFFFF;
        }

        * {
            box-sizing: border-box; font-family: 'GenSenRounded2TW', 'Noto Sans TC', sans-serif;
            margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent;
            touch-action: manipulation; 
        }

        body {
            background-color: var(--bg-color); color: var(--text-color);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; min-height: 100dvh; 
            padding: 2.5vh 15px 1.5vh 15px; justify-content: space-between; overflow: hidden;
        }

        #main-screen-container {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: flex-start; padding-top: 1vh; width: 100%; max-width: 500px;
        }

        #main-screen { width: 100%; display: flex; flex-direction: column; align-items: center; }
        h1 { font-size: 24px; font-weight: 900; margin-bottom: 2.5vh; color: #333; text-align: center; }

        .severity-selector { background: var(--card-bg); padding: 15px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 3vh; text-align: center; width: 100%; }
        .severity-selector p { font-size: 14px; font-weight: 700; margin-bottom: 12px; }

        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 12px; border-radius: 6px; background: #eee; outline: none; margin: 10px 0; border: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 36px; height: 36px; cursor: pointer; background: var(--thumb-img) center/contain no-repeat; background-color: transparent; border: none; outline: none; box-shadow: none; transform: translateY(-2px); }

        .game-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; }

        .game-btn { background-color: var(--card-bg); border: none; border-radius: 12px; padding: clamp(12px, 2vh, 18px) 5px; font-size: 14px; font-weight: 700; color: var(--text-color); cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: transform 0.1s; display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 6px; white-space: nowrap; }
        .game-btn:active { transform: scale(0.95); }
        .game-btn .icon { font-size: 18px; }

        footer { margin-top: auto; font-size: 11px; font-weight: 500; color: #aaaaaa; text-align: center; }

        #game-screen { display: none; flex: 1; flex-direction: column; align-items: center; width: 100%; max-width: 500px; justify-content: center; position: relative; }
        .back-btn { position: absolute; top: 0; left: 0; background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 20px; font-size: 14px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 179, 186, 0.4); z-index: 500; }
        
        .game-container { width: 100%; flex: 1; max-height: 72vh; display: flex; justify-content: center; align-items: center; background: var(--card-bg); border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; position: relative; margin-top: 45px; margin-bottom: 15px; flex-direction: column; }

        /* --- éŠæˆ²å…±ç”¨æ’ç‰ˆ (çµ•å°ç¶­æŒ V10.0 ä¸å‹•ï¼) --- */
        .game-layout { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: space-between; align-items: center; padding: 25px 10px; position: relative; }

        /* --- å‰ä¸ƒå€‹éŠæˆ² CSS å®Œç¾å°å­˜ --- */
        .puzzle-board { width: 200px; height: 200px; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; background: #eee; border: 4px solid #ddd; border-radius: 10px; margin-bottom: 20px; position: relative; }
        .puzzle-slot { width: 100%; height: 100%; background: #fafafa; border-radius: 4px; }
        .puzzle-piece { width: 96px; height: 96px; position: absolute; border-radius: 4px; background-size: 200px 200px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.2s; z-index: 2; cursor: pointer; pointer-events: auto; }
        .puzzle-piece.snapped { box-shadow: none; z-index: 1; pointer-events: none; }
        .bubble-wrap { display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; padding: 10px; margin: auto 0; }
        .bubble { width: 35px; height: 35px; background: radial-gradient(circle at 30% 30%, #ffffff, #BAE1FF); border-radius: 50%; box-shadow: inset 0 -2px 5px rgba(0,0,0,0.1), 0 2px 5px rgba(0,0,0,0.2); cursor: pointer; }
        .bubble.popped { background: #e0f0ff; box-shadow: inset 0 2px 5px rgba(0,0,0,0.1); transform: scale(0.9); }
        .pencil-stage { display: flex; align-items: flex-end; gap: 10px; height: 220px; border-bottom: 5px solid #eee; padding-bottom: 10px; margin: auto 0; }
        .pencil { width: 30px; border-radius: 3px 3px 0 0; position: relative; cursor: pointer; transition: height 0.1s; display: flex; justify-content: center; box-shadow: inset -5px 0 10px rgba(0,0,0,0.1); }
        .pencil::after { content: ''; position: absolute; top: 0; left: 0; width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 25px solid #FFDFBA; transform: translateY(-100%); z-index: 1;}
        .pencil::before { content: ''; position: absolute; top: -25px; left: 7.5px; width: 0; height: 0; border-left: 7.5px solid transparent; border-right: 7.5px solid transparent; border-bottom: 12px solid var(--pen-color); z-index: 2; }
        .color-stage { display: flex; flex-direction: column; gap: 6px; width: 80%; margin: auto 0; }
        .color-block { height: 35px; border-radius: 10px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .color-block.selected { transform: scale(0.95); box-shadow: inset 0 4px 6px rgba(0,0,0,0.2); border: 3px solid #333; }
        .head-wrapper { width: 240px; height: 260px; position: relative; margin: auto 0; }
        .face-container { width: 100%; height: 100%; border-radius: 50% 50% 45% 45%; box-shadow: inset -15px -20px 40px rgba(0,0,0,0.15), inset 10px 10px 20px rgba(255,255,255,0.4), 0 10px 20px rgba(0,0,0,0.05); position: absolute; top: 0; left: 0; overflow: hidden; transition: background 0.3s; z-index: 2; }
        .ear { position: absolute; width: 45px; height: 60px; border-radius: 50%; top: 40%; z-index: 1; transition: background 0.3s; box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1), inset 5px 5px 10px rgba(255,255,255,0.3); }
        .ear.left { left: -20px; transform: rotate(-15deg); }
        .ear.right { right: -20px; transform: rotate(15deg); }
        .face-eyes { position: absolute; top: 42%; width: 100%; display: flex; justify-content: center; gap: 40px; pointer-events: none; }
        .eye { width: 16px; height: 16px; border-radius: 50%; background: radial-gradient(circle at 35% 35%, #555, #111); box-shadow: inset 2px 2px 4px rgba(0,0,0,0.5), 0 2px 4px rgba(255,255,255,0.4); }
        .face-blush { position: absolute; top: 48%; width: 100%; display: flex; justify-content: center; gap: 60px; pointer-events: none; }
        .blush { width: 25px; height: 15px; border-radius: 50%; opacity: 0.6; filter: blur(2px); transition: background 0.3s; }
        .face-nose { position: absolute; top: 52%; left: 50%; transform: translateX(-50%); width: 22px; height: 14px; border-radius: 50%; filter: brightness(0.95); pointer-events: none; box-shadow: -2px 3px 5px rgba(0,0,0,0.15), inset 2px 2px 5px rgba(255,255,255,0.5); transition: background 0.3s; }
        .face-mouth { position: absolute; top: 64%; left: 50%; transform: translateX(-50%); width: 18px; height: 20px; background: #6A040F; border-radius: 10px 10px 20px 20px; overflow: hidden; pointer-events: none; box-shadow: inset 0 4px 5px rgba(0,0,0,0.4); }
        .face-mouth::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 14px; height: 10px; background: #FF8C8C; border-radius: 10px 10px 0 0; }
        .pimple { position: absolute; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: transform 0.1s; z-index: 10; }
        .pimple-core { width: 30%; height: 30%; background: #FFFACD; border-radius: 50%; opacity: 0.9; }

        .cat-box-grid { width: 260px; height: 260px; background: #E6C280; border: 12px solid #C79A47; border-radius: 15px; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 6px; padding: 6px; box-shadow: inset 0 5px 20px rgba(0,0,0,0.25), 0 15px 25px rgba(0,0,0,0.1); z-index: 10; margin: auto 0; }
        .cat-slot { background: rgba(0,0,0,0.06); border-radius: 8px; display: flex; justify-content: center; align-items: center; position: relative; }
        .cat-silhouette { width: 85%; height: 85%; object-fit: contain; filter: brightness(0) opacity(0.15) drop-shadow(0 2px 2px rgba(0,0,0,0.5)); pointer-events: none; }
        .cats-free-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; overflow: visible; }
        .draggable-cat { width: 75px; height: 75px; object-fit: contain; position: absolute; cursor: grab; pointer-events: auto; filter: drop-shadow(0 6px 8px rgba(0,0,0,0.3)); transition: transform 0.1s; }
        .draggable-cat.snapped { position: absolute !important; width: 85% !important; height: 85% !important; left: 7.5% !important; top: 7.5% !important; transform: none !important; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); z-index: 2; pointer-events: none; }
        .fallback-cat { background: #FFB3BA; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 30px; }

        .shelves-wrapper { width: 95%; flex: 1; display: flex; flex-direction: column; justify-content: space-evenly; align-items: center; margin: 35px 0 45px 0; z-index: 5; }
        .shelf { width: 100%; height: 14px; background: #C79A47; border-radius: 8px; position: relative; border: 2px solid #b3883b; box-shadow: inset 0 4px 6px rgba(255,255,255,0.4), inset 0 -4px 6px rgba(0,0,0,0.2), 0 10px 15px rgba(0,0,0,0.15); display: flex; align-items: flex-end; justify-content: space-around; }
        .shelf::after { content: ''; position: absolute; bottom: -15px; left: 2%; width: 96%; height: 8px; background: rgba(0,0,0,0.1); border-radius: 50%; filter: blur(3px); }
        .shelf-item { position: relative; display: flex; justify-content: center; align-items: center; margin-bottom: -1px; z-index: 2; }
        .item-1 { width: 45px; height: 35px; background: #F2C6D0; border-radius: 10px; box-shadow: inset -4px -6px 8px rgba(0,0,0,0.15), inset 4px 6px 8px rgba(255,255,255,0.6), 0 4px 6px rgba(0,0,0,0.1); }
        .item-1::before { content:''; position:absolute; top: -6px; width: 25px; height: 6px; background: #FFB3BA; border-radius: 3px 3px 0 0; }
        .item-2 { width: 35px; height: 55px; background: #FFF9F0; border-radius: 15px 15px 5px 5px; box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1), inset 5px 5px 10px rgba(255,255,255,0.8), 0 4px 6px rgba(0,0,0,0.1); border: 1px solid #eee; }
        .item-2::before { content:''; position:absolute; top: -5px; width: 18px; height: 5px; background: #FFDFBA; border-radius: 3px; }
        .item-3 { width: 40px; height: 50px; background: #FFDFBA; border-radius: 6px; box-shadow: inset -3px -4px 6px rgba(0,0,0,0.15), inset 3px 4px 6px rgba(255,255,255,0.5), 0 4px 6px rgba(0,0,0,0.1); border: 2px solid #E6C280; }
        .item-4 { width: 30px; height: 55px; background: #FF6B6B; border-radius: 8px; box-shadow: inset -5px 0 10px rgba(0,0,0,0.2), inset 5px 0 10px rgba(255,255,255,0.4), 0 4px 6px rgba(0,0,0,0.1); border-top: 3px solid #ddd; border-bottom: 3px solid #ddd; }
        .item-5 { width: 35px; height: 45px; background: #BAFFC9; border-radius: 20px; box-shadow: inset -5px -8px 10px rgba(0,0,0,0.15), inset 5px 5px 10px rgba(255,255,255,0.6), 0 4px 6px rgba(0,0,0,0.1); }
        .item-5::before { content:''; position:absolute; top: -6px; width: 25px; height: 6px; background: #8EE8A6; border-radius: 5px 5px 0 0; }
        .sticker-wrap { position: absolute; z-index: 5; pointer-events: auto; }
        .realistic-sticker { width: 22px; height: 14px; background: #FFF; border-radius: 2px; box-shadow: -1px 2px 4px rgba(0,0,0,0.2), inset 1px 1px 2px rgba(255,255,255,0.8); border: 1px solid #eee; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden; }
        .barcode-lines { width: 80%; height: 6px; background: repeating-linear-gradient(90deg, #333, #333 1px, transparent 1px, transparent 3px); opacity: 0.6; }
        .price-line { width: 50%; height: 2px; background: #FF6B6B; margin-top: 2px; }
        .sticker-hitbox { position: absolute; top: -20px; bottom: -20px; left: -20px; right: -20px; z-index: 10; }
        @keyframes peelFall { 0% { transform: translateY(0) rotate(0) scale(1); opacity: 1; } 40% { transform: translateY(20px) rotate(15deg) scale(1.1); opacity: 0.9; } 100% { transform: translateY(120px) rotate(60deg) scale(0.5); opacity: 0; } }
        .peeled { animation: peelFall 0.4s ease-in forwards; pointer-events: none !important; z-index: 20; }

        /* ========================================= */
        /* --- 8. æœ¨å¡Šè§£è¬ CSS (ç¶­æŒç„¡æ®˜å½±è¨­è¨ˆ) --- */
        .wood-board { 
            width: 244px; height: 244px; background: #8B5A2B; border: 6px solid #5C3A21; border-radius: 8px;
            display: grid; grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(6, 1fr); gap: 2px; padding: 2px;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.4), 0 8px 15px rgba(0,0,0,0.2); position: relative; z-index: 10; margin: auto 0;
        }
        .wood-cell { background: rgba(0,0,0,0.2); border-radius: 4px; }
        .wood-piece-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; overflow: visible; }
        .wood-piece { position: absolute; cursor: grab; pointer-events: auto; z-index: 100; transition: transform 0.1s; transform: translateZ(0); } 
        .wood-block-unit { 
            width: 38px; height: 38px; position: absolute; border-radius: 4px; border: 1px solid rgba(0,0,0,0.3);
            box-shadow: inset 2px 2px 4px rgba(255,255,255,0.4), inset -2px -2px 4px rgba(0,0,0,0.2), 2px 2px 4px rgba(0,0,0,0.3);
            background-blend-mode: overlay; 
        }
        .wood-piece.snapped { z-index: 20; }
        .wood-piece.snapped .wood-block-unit { box-shadow: inset 2px 2px 4px rgba(255,255,255,0.4), inset -2px -2px 4px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.5); }

        /* --- 9. èª¿é…é¡æ–™ CSS --- */
        .bottles-container { width: 100%; display: flex; flex-direction: column; gap: 25px; align-items: center; justify-content: center; margin: auto 0; z-index: 10; }
        .bottle-row { display: flex; gap: 12px; justify-content: center; width: 100%; }
        .bottle { 
            width: 38px; height: 110px; border: 3px solid rgba(200,200,200,0.8); border-top: none; 
            border-radius: 0 0 18px 18px; display: flex; flex-direction: column-reverse; justify-content: flex-start;
            padding: 2px; overflow: hidden; position: relative; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: inset -3px 0 5px rgba(0,0,0,0.1), inset 3px 0 5px rgba(255,255,255,0.5); background: rgba(255,255,255,0.3);
        }
        .bottle::before { content: ''; position: absolute; top: -10px; left: -3px; width: 38px; height: 10px; border: 3px solid rgba(200,200,200,0.8); border-radius: 5px; }
        .bottle.selected { transform: translateY(-15px); box-shadow: 0 10px 15px rgba(0,0,0,0.1), inset -3px 0 5px rgba(0,0,0,0.1), inset 3px 0 5px rgba(255,255,255,0.5); border-color: #FFB3BA; }
        .liquid-layer { width: 100%; height: 25px; border-radius: 4px; margin-top: 1px; transition: height 0.3s; }

        /* --- 10. ç¢æ‰ç…©æƒ± CSS --- */
        .shredder-stage { position: relative; width: 240px; height: 180px; margin: auto 0; display: flex; flex-direction: column; align-items: center; z-index: 10; }
        .shredder-back { position: absolute; top: 0; left: 10px; width: 220px; height: 50px; background: #c0c0c0; border-radius: 10px 10px 0 0; z-index: 1; border: 2px solid #aaa; border-bottom: none; }
        .shredder-slot { position: absolute; top: 40px; left: 40px; width: 160px; height: 10px; background: #111; border-radius: 5px; box-shadow: inset 0 3px 5px rgba(0,0,0,0.9); z-index: 5; }
        .shredder-front { position: absolute; top: 45px; left: 10px; width: 220px; height: 60px; background: #e0e0e0; border-radius: 0 0 10px 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.15), inset 0 5px 10px rgba(255,255,255,0.8); z-index: 20; border: 2px solid #aaa; border-top: none; }
        .shredder-bin { position: absolute; top: 105px; left: 20px; width: 200px; height: 75px; background: rgba(0,0,0,0.15); border: 2px solid rgba(200,200,200,0.5); border-top: none; border-radius: 0 0 10px 10px; z-index: 2; box-shadow: inset 0 5px 10px rgba(0,0,0,0.1); backdrop-filter: blur(2px); }
        .papers-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }
        .draggable-paper { 
            width: 90px; height: 130px; background: #fff; box-shadow: 0 5px 10px rgba(0,0,0,0.15); border: 1px solid #eee;
            position: absolute; cursor: grab; pointer-events: auto; display: flex; justify-content: center; align-items: center;
            font-weight: 900; font-size: 18px; color: #d00000; letter-spacing: 2px; writing-mode: vertical-rl; text-orientation: upright; z-index: 55;
            text-align: center; line-height: 1.4; padding: 10px;
        }
        @keyframes shred-paper-anim {
            0% { transform: translateY(0); opacity: 1;}
            100% { transform: translateY(120px); opacity: 0;}
        }
        .shred-paper-anim { animation: shred-paper-anim 1.5s linear forwards; pointer-events: none !important; }
        @keyframes shred-strips-anim {
            0% { transform: translateY(0); height: 0; opacity: 1; }
            50% { height: 70px; opacity: 1; }
            100% { transform: translateY(80px); height: 70px; opacity: 0; }
        }
        .shred-strips-anim { position: absolute; display: flex; width: 90px; animation: shred-strips-anim 1.5s linear forwards; pointer-events: none; z-index: 15; }
        .shred-strips-anim .stripe { flex: 1; background: #fff; border-right: 1px solid #ddd; }

    </style>
</head>
<body>

    <div id="main-screen-container">
        <div id="main-screen">
            <h1>ğŸ§  è§£å£“æ²»ç™‚æ‰€ Brain SPA âœ¨</h1>
            <div class="severity-selector">
                <p>è«‹é¸æ“‡ä½ ç›®å‰çš„å¼·è¿«ç—‡ç™¼ä½œæŒ‡æ•¸</p>
                <input type="range" id="severity-slider" min="0" max="10" value="5">
                <div style="display: flex; justify-content: space-between; font-size: 11px; font-weight: 500; color: #aaa; margin-top: 5px;">
                    <span>å¾®ç„¦æ…®</span><span>å¿«çˆ†ç‚¸</span>
                </div>
            </div>

            <div class="game-grid">
                <button type="button" class="game-btn" onclick="startGame('puzzle')"><span class="icon">ğŸ§©</span> ç™‚ç™’æ‹¼åœ–</button>
                <button type="button" class="game-btn" onclick="startGame('bubble')"><span class="icon">ğŸ«§</span> ææ³¡æ³¡ç´™</button>
                <button type="button" class="game-btn" onclick="startGame('pencil')"><span class="icon">ğŸ–ï¸</span> é‰›ç­†å‰Šå¹³</button>
                <button type="button" class="game-btn" onclick="startGame('color')"><span class="icon">ğŸŒˆ</span> é¡è‰²æ’åº</button>
                <button type="button" class="game-btn" onclick="startGame('pimple')"><span class="icon">ğŸ’¥</span> æ“ çˆ†ç—˜ç—˜</button>
                <button type="button" class="game-btn" onclick="startGame('cat')"><span class="icon">ğŸ“¦</span> è²“å’ªæ­¸ä½</button>
                <button type="button" class="game-btn" onclick="startGame('peel')"><span class="icon">ğŸ©¹</span> æ’•é™¤æ¨™ç±¤</button>
                <button type="button" class="game-btn" onclick="startGame('wood')"><span class="icon">ğŸªµ</span> æœ¨å¡Šè§£è¬</button>
                <button type="button" class="game-btn" onclick="startGame('watersort')"><span class="icon">ğŸ§ª</span> èª¿é…é¡æ–™</button>
                <button type="button" class="game-btn" onclick="startGame('shredder')"><span class="icon">ğŸ“„</span> ç¢æ‰ç…©æƒ±</button>
            </div>
        </div>
    </div>

    <div id="game-screen">
        <button type="button" class="back-btn" onclick="showMainScreen()">ğŸ”™ è¿”å›æ²»ç™‚æ‰€</button>
        <div class="game-container" id="game-content"></div>
    </div>

    <footer>Â© 2026 an App a Day Project.</footer>

    <script>
        // ==========================================
        // ã€0.5ç§’çµ•å°é˜²å‘†æ™‚é–“é–ã€‘å¾¹åº•æœçµ•å¹½éˆéŸ³æ•ˆ
        // ==========================================
        window.gameStartTime = 0;

        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        const audioBuffers = {};

        async function loadAudio(name, url) {
            try {
                const response = await fetch(url);
                const arrayBuffer = await response.arrayBuffer();
                const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
                audioBuffers[name] = audioBuffer;
            } catch (e) { console.log(`éŸ³æ•ˆ ${name} è¼‰å…¥å¤±æ•—`); }
        }

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
                loadAudio('pop', 'pop.mp3'); loadAudio('shave', 'shave.mp3');
                loadAudio('pimple', 'pimple.mp3'); loadAudio('cat', 'cat.mp3'); loadAudio('peel', 'peel.mp3');
                loadAudio('wood', 'wood.mp3'); loadAudio('pour', 'pour.mp3'); loadAudio('shred', 'shred.mp3');
            }
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function wakeUpAudio() { if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume(); }
        document.body.addEventListener('touchstart', wakeUpAudio, { capture: true, passive: true });
        document.body.addEventListener('click', wakeUpAudio, { capture: true, passive: true });

        function playSound(name) {
            if (Date.now() - window.gameStartTime < 500) return;
            if (!audioCtx || !audioBuffers[name]) return;
            wakeUpAudio(); 
            const source = audioCtx.createBufferSource();
            source.buffer = audioBuffers[name];
            source.connect(audioCtx.destination);
            source.start(0);
        }

        const mainScreenContainer = document.getElementById('main-screen-container');
        const gameScreen = document.getElementById('game-screen');
        const gameContent = document.getElementById('game-content');
        const slider = document.getElementById('severity-slider');
        const emojis = ['ğŸ«£', 'ğŸ˜–', 'ğŸ«¨', 'ğŸ˜µâ€ğŸ’«', 'ğŸ« ', 'ğŸ¥¶', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ˜µ', 'ğŸ¤¯', 'ğŸ’¥'];

        function updateSliderEmoji() {
            const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><text x="50%" y="50%" dominant-baseline="central" text-anchor="middle" font-size="30">${emojis[parseInt(slider.value)]}</text></svg>`;
            slider.style.setProperty('--thumb-img', `url('data:image/svg+xml;utf8,${encodeURIComponent(svg)}')`);
        }
        slider.addEventListener('input', updateSliderEmoji); updateSliderEmoji();

        function startGame(gameId) {
            initAudio(); 
            mainScreenContainer.style.display = 'none';
            gameScreen.style.display = 'flex'; document.querySelector('footer').style.display = 'none';
            gameContent.innerHTML = ''; 
            
            if (gameId === 'puzzle') initPuzzleGame();
            if (gameId === 'bubble') initBubbleGame();
            if (gameId === 'pencil') initPencilGame();
            if (gameId === 'color') initColorGame();
            if (gameId === 'pimple') initPimpleGame();
            if (gameId === 'cat') initCatGame();
            if (gameId === 'peel') initPeelGame();
            if (gameId === 'wood') initWoodGame();
            if (gameId === 'watersort') initWaterSortGame();
            if (gameId === 'shredder') initShredderGame();
            
            window.gameStartTime = Date.now();
        }

        function showMainScreen() {
            gameScreen.style.display = 'none';
            mainScreenContainer.style.display = 'flex'; document.querySelector('footer').style.display = 'block';
        }

        function restartGame(initFunc) {
            gameContent.innerHTML = ''; 
            setTimeout(() => { 
                initFunc(); 
                window.gameStartTime = Date.now(); 
            }, 50);
        }

        // =================================================================
        // å‰ä¸ƒå€‹éŠæˆ²å®Œå…¨å°å­˜ä¸å‹• (ä½¿ç”¨V10.0å®Œç¾æ’ç‰ˆ)
        // =================================================================
        const puzzlePatterns = ['linear-gradient(135deg, #FFB3BA, #BAE1FF)', 'linear-gradient(135deg, #FFDFBA, #FFFFBA)', 'linear-gradient(135deg, #BAFFC9, #BAE1FF)', 'linear-gradient(135deg, #E0BBE4, #957DAD)', 'linear-gradient(135deg, #D291BC, #FEC8D8)', 'linear-gradient(135deg, #FFC3A0, #FFAFBD)', 'linear-gradient(135deg, #A18CD1, #FBC2EB)', 'linear-gradient(135deg, #84FAB0, #8FD3F4)', 'linear-gradient(135deg, #FCCB90, #D57EEB)', 'linear-gradient(135deg, #F093FB, #F5576C)'];
        let lastPuzzleIndex = -1;
        window.initPuzzleGame = function() { let nextIndex; do { nextIndex = Math.floor(Math.random() * puzzlePatterns.length); } while (nextIndex === lastPuzzleIndex); lastPuzzleIndex = nextIndex; let currentPattern = puzzlePatterns[nextIndex]; gameContent.innerHTML = `<div class="game-layout"><p style="margin:0;font-weight:700;text-align:center;z-index:20;">å–®æ“Šå¯æ—‹è½‰ï¼Œä¸¦æ‹–æ›³åˆ°æ­£ç¢ºä½ç½®</p><div class="puzzle-board" id="p-board" style="z-index:10; margin:auto 0;"><div class="puzzle-slot" id="slot-0"></div><div class="puzzle-slot" id="slot-1"></div><div class="puzzle-slot" id="slot-2"></div><div class="puzzle-slot" id="slot-3"></div></div><button type="button" onpointerdown="event.stopPropagation(); restartGame(initPuzzleGame)" style="padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;z-index:20;">ğŸ”„ å†æ‹¼ä¸€çµ„</button><div id="pieces-container" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:15;"></div></div>`; const pBoard = document.getElementById('p-board'); const pContainer = document.getElementById('pieces-container'); const positions = ['0 0', '-100px 0', '0 -100px', '-100px -100px']; let snappedCount = 0; for(let i=0; i<4; i++) { let piece = document.createElement('div'); piece.className = 'puzzle-piece'; piece.style.backgroundImage = currentPattern; piece.style.backgroundPosition = positions[i]; piece.dataset.id = i; piece.style.pointerEvents = 'auto'; let startX = Math.random() * 150 + 20; let startY = Math.random() * 60 + 20; let rot = Math.floor(Math.random() * 4) * 90; piece.dataset.rot = rot; piece.style.left = startX + 'px'; piece.style.top = startY + 'px'; piece.style.transform = `rotate(${rot}deg)`; pContainer.appendChild(piece); let isDragging = false, hasMoved = false, offsetX, offsetY, touchStartX, touchStartY; piece.addEventListener('touchstart', e => { if(Date.now() - window.gameStartTime < 500) return; isDragging = true; hasMoved = false; let touch = e.touches[0]; touchStartX = touch.clientX; touchStartY = touch.clientY; let rect = piece.getBoundingClientRect(); offsetX = touch.clientX - rect.left; offsetY = touch.clientY - rect.top; piece.style.zIndex = 30; }); piece.addEventListener('touchmove', e => { if(!isDragging) return; let touch = e.touches[0]; if(Math.abs(touch.clientX - touchStartX) > 5 || Math.abs(touch.clientY - touchStartY) > 5) hasMoved = true; piece.style.position = 'fixed'; piece.style.left = (touch.clientX - offsetX) + 'px'; piece.style.top = (touch.clientY - offsetY) + 'px'; e.preventDefault(); }, {passive: false}); piece.addEventListener('touchend', e => { if(!isDragging) return; isDragging = false; piece.style.zIndex = 15; if(!hasMoved) { rot = (rot + 90) % 360; piece.dataset.rot = rot; piece.style.transform = `rotate(${rot}deg)`; return; } let slot = document.getElementById('slot-' + i); let dx = Math.abs(slot.getBoundingClientRect().left - piece.getBoundingClientRect().left); let dy = Math.abs(slot.getBoundingClientRect().top - piece.getBoundingClientRect().top); if(dx < 30 && dy < 30 && rot === 0) { piece.classList.add('snapped'); piece.style.position = 'absolute'; piece.style.left = slot.offsetLeft + 'px'; piece.style.top = slot.offsetTop + 'px'; pBoard.appendChild(piece); snappedCount++; if(snappedCount === 4) setTimeout(() => alert('âœ¨ æ‹¼åœ–å®Œæˆï¼ç•«é¢å¤ªèˆ’æœäº†ï¼'), 300); } }); } }
        let poppedBubblesCount = 0; window.initBubbleGame = function() { poppedBubblesCount = 0; let html = `<div class="bubble-wrap">`; for(let i=0; i<36; i++) { html += `<div class="bubble" onclick="popBubble(this)"></div>`; } gameContent.innerHTML = `<div class="game-layout"><p style="margin:0;font-weight:700;text-align:center;">ç›¡æƒ…æçˆ†å®ƒå€‘å§ï¼</p>${html}</div><button type="button" onpointerdown="event.stopPropagation(); restartGame(initBubbleGame)" style="padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ æ›å¼µæ–°çš„</button></div>`; }
        window.popBubble = function(el) { if(Date.now() - window.gameStartTime < 500) return; if(!el.classList.contains('popped')) { el.classList.add('popped'); playSound('pop'); poppedBubblesCount++; if(poppedBubblesCount === 36) setTimeout(() => alert('âœ¨ æ³¡æ³¡å…¨æçˆ†äº†ï¼ç¥æ¸…æ°£çˆ½ï¼'), 300); } }
        window.initPencilGame = function() { const colors = ['#FF6B6B', '#FFA06B', '#FFD166', '#06D6A0', '#118AB2', '#8338EC']; let heights = colors.map(() => Math.floor(Math.random() * 11 + 10) * 10); let targetHeight = Math.min(...heights); let html = `<div class="game-layout"><p style="margin:0;font-weight:700;text-align:center;">é»æ“Šéé•·çš„é‰›ç­†ï¼ŒæŠŠå®ƒå€‘å‰Šé½Šå¹³ï¼</p><div class="pencil-stage">`; colors.forEach((c, idx) => { html += `<div class="pencil" id="pen-${idx}" style="height:${heights[idx]}px; background:${c}; --pen-color:${c};" onclick="shavePen(${idx})"></div>`; }); gameContent.innerHTML = html + `</div><button type="button" onpointerdown="event.stopPropagation(); restartGame(initPencilGame)" style="padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ æ›ä¸€æŠŠç­†</button></div>`; window.shavePen = function(idx) { if(Date.now() - window.gameStartTime < 500) return; const el = document.getElementById(`pen-${idx}`); let h = parseInt(el.style.height); if(h > targetHeight) { el.style.height = (h - 10) + 'px'; playSound('shave'); } let allEqual = true; for(let i=0; i<6; i++) { if(parseInt(document.getElementById(`pen-${i}`).style.height) !== targetHeight) { allEqual = false; break; } } if(allEqual) setTimeout(() => alert('âœ¨ å…¨éƒ¨ä¸€æ¨£å¹³äº†ï¼å¼·è¿«ç—‡æ²»ç™’ï¼'), 300); } }
        const palettes = [['#732031','#A12D45','#D03958','#E85B7A','#EF8A9F','#F4B3C0','#F9D9DF','#FDF1F3'],['#03045E','#023E8A','#0077B6','#0096C7','#00B4D8','#48CAE4','#90E0EF','#CAF0F8'],['#081C15','#1B4332','#2D6A4F','#40916C','#52B788','#74C69D','#95D5B2','#B7E4C7'],['#370617','#6A040F','#9D0208','#D00000','#DC2F02','#E85D04','#F48C06','#FAA307'],['#10002B','#240046','#3C096C','#5A189A','#7B2CBF','#9D4EDD','#C77DFF','#E0AAFF']]; window.initColorGame = function() { let correctOrder = palettes[Math.floor(Math.random() * palettes.length)]; let currentOrder = [...correctOrder].sort(() => Math.random() - 0.5); window.renderColorBlocks = () => { let html = `<div class="game-layout"><div style="text-align:center;"><p style="font-weight:700; margin-bottom:5px;">é»æ“Šå…©å¡Šé¡è‰²ä¾†äº’ç›¸äº¤æ›ä½ç½®</p><p style="font-size:12px; color:#888;">è«‹å°‡é¡è‰²ç”±ä¸Šè€Œä¸‹ï¼Œä¾åºå¾ã€Œæœ€æ·±ã€æ’åˆ—åˆ°ã€Œæœ€æ·ºã€</p></div><div class="color-stage">`; currentOrder.forEach((color, idx) => { html += `<div class="color-block" style="background:${color}" onclick="selectColor(${idx})" id="cb-${idx}"></div>`; }); gameContent.innerHTML = html + `</div><button type="button" onpointerdown="event.stopPropagation(); restartGame(initColorGame)" style="padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ æ›ä¸€çµ„é¡è‰²</button></div>`; }; let selectedIdx = -1; window.selectColor = function(idx) { if(Date.now() - window.gameStartTime < 500) return; const block = document.getElementById(`cb-${idx}`); if(selectedIdx === -1) { selectedIdx = idx; block.classList.add('selected'); } else { let temp = currentOrder[selectedIdx]; currentOrder[selectedIdx] = currentOrder[idx]; currentOrder[idx] = temp; selectedIdx = -1; renderColorBlocks(); if(JSON.stringify(currentOrder) === JSON.stringify(correctOrder)) setTimeout(() => alert('âœ¨ æ¼¸å±¤å¥½å®Œç¾ï¼çœ¼ç›ç™‚ç™’äº†ï¼'), 300); } }; renderColorBlocks(); }
        const faceConfigs = [{ bg: '#FFF5E1', blush: '#FFD1D1' }, { bg: '#FFE4C4', blush: '#FFB6C1' }, { bg: '#FCD5CE', blush: '#F08080' }, { bg: '#F8C8B5', blush: '#E9967A' }, { bg: '#EAC0A6', blush: '#CD853F' }]; window.initPimpleGame = function() { gameContent.innerHTML = `<div class="game-layout"><p style="margin:0;font-weight:700;text-align:center;">é€£é»ç—˜ç—˜æŠŠå®ƒå€‘å…¨éƒ¨æ“ çˆ†ï¼</p><div class="head-wrapper"><div class="ear left" id="ear-l"></div><div class="ear right" id="ear-r"></div><div class="face-container" id="face-area"><div class="face-eyes"><div class="eye"></div><div class="eye"></div></div><div class="face-blush" id="face-blush"><div class="blush"></div><div class="blush"></div></div><div class="face-nose" id="face-nose"></div><div class="face-mouth"></div></div></div><button type="button" onpointerdown="event.stopPropagation(); restartGame(initPimpleGame)" style="padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ æ›å¼µè‡‰</button></div>`; const face = document.getElementById('face-area'); const config = faceConfigs[Math.floor(Math.random() * faceConfigs.length)]; face.style.background = config.bg; document.getElementById('ear-l').style.background = config.bg; document.getElementById('ear-r').style.background = config.bg; document.getElementById('face-nose').style.background = config.bg; document.getElementById('face-blush').children[0].style.background = config.blush; document.getElementById('face-blush').children[1].style.background = config.blush; const pimpleCount = Math.floor(Math.random() * 3) + 6; let poppedTotal = 0; for(let i=0; i<pimpleCount; i++) { let p = document.createElement('div'); let size = Math.random() * 20 + 20; p.className = 'pimple'; p.style.width = size + 'px'; p.style.height = size + 'px'; let leftPos = Math.random() * 70 + 15; let topPos = Math.random() * 80 + 10; if(leftPos > 25 && leftPos < 75 && topPos > 35 && topPos < 70) topPos = topPos > 52 ? 75 : 15; p.style.left = leftPos + '%'; p.style.top = topPos + '%'; p.style.background = `radial-gradient(circle at 30% 30%, ${Math.random() > 0.5 ? '#FF8C8C' : '#FF4040'}, #B22222)`; p.style.boxShadow = `-3px 4px 8px rgba(0,0,0,0.2), inset 3px 3px 6px rgba(255,255,255,0.4)`; let core = document.createElement('div'); core.className = 'pimple-core'; p.appendChild(core); face.appendChild(p); let clicksNeeded = Math.floor(Math.random() * 11) + 10; let currentClicks = 0; p.addEventListener('touchstart', function(e) { e.preventDefault(); handlePimpleClick(); }, {passive: false}); p.addEventListener('mousedown', function(e) { e.preventDefault(); handlePimpleClick(); }); function handlePimpleClick() { if(Date.now() - window.gameStartTime < 500 || currentClicks >= clicksNeeded) return; currentClicks++; p.style.transform = `scale(${1 + currentClicks * 0.05})`; if(currentClicks === clicksNeeded) { playSound('pimple'); p.style.display = 'none'; poppedTotal++; if(poppedTotal === pimpleCount) setTimeout(() => alert('âœ¨æ¶ˆæ»…ç—˜ç—˜ï¼è‡‰è›‹è®Šå¹³æ»‘äº†ï¼'), 400); } } } }
        window.initCatGame = function() { gameContent.innerHTML = `<div class="game-layout"><p style="margin:0; font-weight:700; text-align:center; z-index:20; position:relative;">å°‡æ•£è½çš„å°è²“æ‹–æ›³å›ç´™ç®±æ­£ç¢ºçš„ä½ç½®</p><div class="cat-box-grid" id="cat-box-grid"></div><button type="button" onpointerdown="event.stopPropagation(); restartGame(initCatGame)" style="padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer; position:relative; z-index:20;">ğŸ”„ å†æ”¶ä¸€ç®±</button><div class="cats-free-container" id="cats-container"></div></div>`; const grid = document.getElementById('cat-box-grid'); const container = document.getElementById('cats-container'); let snappedCount = 0; let catIds = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5); for(let i=0; i<9; i++) { const catId = catIds[i]; let slot = document.createElement('div'); slot.className = 'cat-slot'; slot.id = 'cat-slot-' + catId; slot.innerHTML = `<img src="cat${catId}.png" class="cat-silhouette" onerror="this.outerHTML='<div class=\\'fallback-cat\\' style=\\'width:85%;height:85%;background:rgba(0,0,0,0.1);\\'></div>'">`; grid.appendChild(slot); let cat = document.createElement('img'); cat.src = `cat${catId}.png`; cat.className = 'draggable-cat'; cat.dataset.id = catId; cat.dataset.snapped = 'false'; cat.onerror = function() { this.outerHTML = `<div class='draggable-cat fallback-cat' data-id='${catId}' data-snapped='false' style='left:${this.style.left}; top:${this.style.top}; transform:${this.style.transform};'>ğŸ±</div>`; setTimeout(()=>attachCatEvents(document.querySelector(`.draggable-cat[data-id='${catId}']`)), 100); }; let isTop = Math.random() > 0.5; if (isTop) { cat.style.top = (Math.random() * 8 + 2) + '%'; } else { cat.style.top = (Math.random() * 10 + 75) + '%'; } cat.style.left = (Math.random() * 70 + 10) + '%'; cat.style.transform = `rotate(${(Math.random() - 0.5) * 60}deg)`; container.appendChild(cat); setTimeout(() => { attachCatEvents(cat); }, 300); } function attachCatEvents(catElement) { if(!catElement) return; let isDragging = false, hasMoved = false, offsetX, offsetY, startX = 0, startY = 0; catElement.addEventListener('touchstart', e => { if(catElement.dataset.snapped === 'true') return; isDragging = true; hasMoved = false; let touch = e.touches[0]; startX = touch.clientX; startY = touch.clientY; let rect = catElement.getBoundingClientRect(); offsetX = touch.clientX - rect.left; offsetY = touch.clientY - rect.top; catElement.style.zIndex = 300; }); catElement.addEventListener('touchmove', e => { if(!isDragging) return; let touch = e.touches[0]; if (Math.abs(touch.clientX - startX) > 10 || Math.abs(touch.clientY - startY) > 10) { hasMoved = true; } catElement.style.position = 'fixed'; catElement.style.left = (touch.clientX - offsetX) + 'px'; catElement.style.top = (touch.clientY - offsetY) + 'px'; e.preventDefault(); }, {passive: false}); catElement.addEventListener('touchend', e => { if(!isDragging) return; isDragging = false; catElement.style.zIndex = 'auto'; if(!hasMoved) return; let targetSlot = document.getElementById('cat-slot-' + catElement.dataset.id); let dx = Math.abs(targetSlot.getBoundingClientRect().left - catElement.getBoundingClientRect().left); let dy = Math.abs(targetSlot.getBoundingClientRect().top - catElement.getBoundingClientRect().top); if (dx < 40 && dy < 40 && catElement.dataset.snapped === 'false') { catElement.dataset.snapped = 'true'; catElement.classList.add('snapped'); targetSlot.appendChild(catElement); playSound('cat'); snappedCount++; if(snappedCount === 9) setTimeout(() => alert('âœ¨ å°è²“éƒ½ä¹–ä¹–æ”¶é€²ç®±å­äº†ï¼'), 300); } }); } }
        window.initPeelGame = function() { gameContent.innerHTML = `<div class="game-layout"><p style="margin:0;font-weight:700;text-align:center;position:relative;z-index:20;">æ‰‹æŒ‡ç•¶èœåˆ€ï¼Œæ»‘éå•†å“æ’•ä¸‹æ‰€æœ‰æ¨™ç±¤ï¼</p><div class="shelves-wrapper" id="shelves"></div><button type="button" onpointerdown="event.stopPropagation(); restartGame(initPeelGame)" style="position:relative; z-index:1000; padding:10px 20px; border-radius:15px; border:none; background:var(--primary); color:white; font-weight:700; cursor:pointer;">ğŸ”„ æ›æ‰¹å•†å“</button></div>`; const shelvesContainer = document.getElementById('shelves'); let totalStickers = 0; let peeledCount = 0; for(let row = 0; row < 3; row++) { let shelf = document.createElement('div'); shelf.className = 'shelf'; for(let col = 0; col < 5; col++) { let item = document.createElement('div'); let type = Math.floor(Math.random() * 5) + 1; item.className = `shelf-item item-${type}`; let stickerNum = Math.floor(Math.random() * 2) + 1; for(let s = 0; s < stickerNum; s++) { let wrap = document.createElement('div'); wrap.className = 'sticker-wrap'; wrap.dataset.peeled = 'false'; wrap.innerHTML = `<div class="realistic-sticker"><div class="barcode-lines"></div><div class="price-line"></div></div><div class="sticker-hitbox"></div>`; wrap.style.top = (Math.random() * 40 + 10) + '%'; wrap.style.left = (Math.random() * 40 + 10) + '%'; wrap.style.transform = `rotate(${(Math.random() - 0.5) * 30}deg)`; item.appendChild(wrap); totalStickers++; } shelf.appendChild(item); } shelvesContainer.appendChild(shelf); } let swipeActive = false; let lastPeeledSticker = null; let startSwipeY = 0; setTimeout(() => { shelvesContainer.addEventListener('touchstart', (e) => { swipeActive = true; startSwipeY = e.touches[0].clientY; }, {passive: true}); document.addEventListener('touchend', () => { swipeActive = false; lastPeeledSticker = null; }); shelvesContainer.addEventListener('touchmove', e => { if (Date.now() - window.gameStartTime < 500 || !swipeActive) return; let touch = e.touches[0]; if (touch.clientY - startSwipeY < 10) return; e.preventDefault(); let el = document.elementFromPoint(touch.clientX, touch.clientY); if (el && el.classList.contains('sticker-hitbox')) { let wrap = el.parentElement; if(wrap.dataset.peeled === 'false' && wrap !== lastPeeledSticker) { wrap.dataset.peeled = 'true'; lastPeeledSticker = wrap; wrap.classList.add('peeled'); playSound('peel'); peeledCount++; if(peeledCount === totalStickers) setTimeout(() => alert('âœ¨ è¼•é¬†æ’•å¾—ä¹¾æ·¨æºœæºœï¼'), 400); } } }, {passive: false}); }, 300); }

        // ==========================================
        // --- 8. æœ¨å¡Šè§£è¬ (æ–°å¢æç¤ºåŠŸèƒ½ã€ä¿è­‰è§£æ³•) ---
        // ==========================================
        // é€™æ˜¯æ•¸å­¸ä¿è­‰å¯ä»¥å®Œç¾å¡«æ»¿ 6x6 çš„ 9 å€‹ç¶“å…¸æ–¹å¡Šçµ„åˆ
        const woodShapes = [
            [[1,1],[1,1]], [[1,1],[1,1]], [[1,1],[1,1]], // 3å€‹ 2x2
            [[1,1,1],[1,0,0]],                           // 1å€‹ Lå‹
            [[0,1,0],[1,1,1]],                           // 1å€‹ Tå‹
            [[1,1],[0,1],[0,1]],                         // 1å€‹ é•·Lå‹
            [[0,1,0],[1,1,1]],                           // 1å€‹ Tå‹
            [[1,1,0],[0,1,1]],                           // 1å€‹ Zå‹
            [[1,1,1,1]]                                  // 1å€‹ 1x4 ç›´æ¢
        ];
        // å°æ‡‰çš„é è¨­è§£ç­”ä½ç½®èˆ‡é™£åˆ—æ–¹å‘
        const solutionMap = [
            { id: 0, r: 0, c: 0, mat: [[1,1],[1,1]] },
            { id: 1, r: 0, c: 2, mat: [[1,1],[1,1]] },
            { id: 2, r: 0, c: 4, mat: [[1,1],[1,1]] },
            { id: 3, r: 2, c: 0, mat: [[1,1,1],[1,0,0]] },
            { id: 4, r: 2, c: 2, mat: [[0,1,0],[1,1,1]] },
            { id: 5, r: 2, c: 4, mat: [[1,1],[0,1],[0,1]] },
            { id: 6, r: 3, c: 0, mat: [[0,1,0],[1,1,1]] },
            { id: 7, r: 4, c: 3, mat: [[1,1,0],[0,1,1]] },
            { id: 8, r: 5, c: 0, mat: [[1,1,1,1]] }
        ];
        const woodColors = ['#E63946', '#F4A261', '#E9C46A', '#2A9D8F', '#4A8CD4', '#9D4EDD', '#FFB5A7', '#D4A373', '#A8DADC'];

        window.initWoodGame = function() {
            gameContent.innerHTML = `
                <div class="game-layout">
                    <p style="margin:0;font-weight:700;text-align:center;z-index:20;">å–®æ“Šå¯æ—‹è½‰æ–¹å¡Šï¼Œå°‡æ‰€æœ‰æ–¹å¡Šæ”¾é€²åº•åº§å§</p>
                    <div class="wood-board" id="wood-board"></div>
                    <div style="display:flex; gap:10px; z-index:20; position:relative;">
                        <button type="button" onpointerdown="event.stopPropagation(); window.giveWoodHint()" style="padding:10px 15px;border-radius:15px;border:none;background:#FFD166;color:#555;font-weight:700;cursor:pointer;">ğŸ’¡ ä¾†å€‹æç¤º</button>
                        <button type="button" onpointerdown="event.stopPropagation(); restartGame(initWoodGame)" style="padding:10px 15px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">ğŸ”„ å†è§£ä¸€çµ„</button>
                    </div>
                    <div class="wood-piece-container" id="wood-pieces"></div>
                </div>
            `;
            
            const board = document.getElementById('wood-board');
            const container = document.getElementById('wood-pieces');
            for(let i=0; i<36; i++) board.innerHTML += '<div class="wood-cell"></div>';
            
            window.boardState = Array(6).fill().map(()=>Array(6).fill(null));
            window.snappedCount = 0;
            window.hintIndex = 0;

            window.renderWoodMatrix = function(p, mat, idx) {
                p.innerHTML = ''; 
                let cols = mat[0].length; let rows = mat.length;
                p.style.width = (cols * 38 + (cols-1)*2) + 'px';
                p.style.height = (rows * 38 + (rows-1)*2) + 'px';
                for(let r=0; r<rows; r++) {
                    for(let c=0; c<cols; c++) {
                        if(mat[r][c]) {
                            let blk = document.createElement('div');
                            blk.className = 'wood-block-unit';
                            blk.style.backgroundColor = woodColors[idx]; 
                            blk.style.left = c * 40 + 'px';
                            blk.style.top = r * 40 + 'px';
                            p.appendChild(blk);
                        }
                    }
                }
            }

            woodShapes.forEach((matrix, idx) => {
                let piece = document.createElement('div');
                piece.className = 'wood-piece';
                piece.dataset.id = idx;
                piece.dataset.matrix = JSON.stringify(matrix);
                piece.dataset.snapped = 'false';
                
                window.renderWoodMatrix(piece, matrix, idx);
                
                let isTop = Math.random() > 0.5;
                piece.style.top = isTop ? (Math.random() * 10 + 5) + '%' : (Math.random() * 10 + 75) + '%';
                piece.style.left = (Math.random() * 60 + 10) + '%';
                container.appendChild(piece);

                let isDragging = false, hasMoved = false, offsetX, offsetY, startX, startY;
                let initiallySnapped = false;

                piece.addEventListener('touchstart', e => {
                    if(Date.now() - window.gameStartTime < 500) return;
                    isDragging = true; hasMoved = false; 
                    let touch = e.touches[0]; startX = touch.clientX; startY = touch.clientY;
                    let rect = piece.getBoundingClientRect(); offsetX = touch.clientX - rect.left; offsetY = touch.clientY - rect.top; 
                    piece.style.zIndex = 300; 
                    
                    initiallySnapped = piece.dataset.snapped === 'true';
                });

                piece.addEventListener('touchmove', e => {
                    if(!isDragging) return; 
                    let touch = e.touches[0];
                    if (Math.abs(touch.clientX - startX) > 10 || Math.abs(touch.clientY - startY) > 10) {
                        hasMoved = true;
                        if (initiallySnapped) {
                            piece.dataset.snapped = 'false'; piece.classList.remove('snapped');
                            window.snappedCount--;
                            for(let r=0; r<6; r++) { for(let c=0; c<6; c++) { if(window.boardState[r][c] === idx) window.boardState[r][c] = null; } }
                            initiallySnapped = false; 
                        }
                    }
                    piece.style.position = 'fixed'; piece.style.left = (touch.clientX - offsetX) + 'px'; piece.style.top = (touch.clientY - offsetY) + 'px'; e.preventDefault();
                }, {passive: false});

                piece.addEventListener('touchend', e => {
                    if(!isDragging) return; isDragging = false; piece.style.zIndex = 100;
                    
                    let mat = JSON.parse(piece.dataset.matrix);
                    
                    if(!hasMoved) {
                        if (piece.dataset.snapped === 'true') return;
                        let rows = mat.length; let cols = mat[0].length; let newMat = [];
                        for(let c=0; c<cols; c++) { newMat[c] = []; for(let r=0; r<rows; r++) { newMat[c][r] = mat[rows - 1 - r][c]; } }
                        piece.dataset.matrix = JSON.stringify(newMat); 
                        window.renderWoodMatrix(piece, newMat, idx);
                        return;
                    }

                    let boardRect = board.getBoundingClientRect();
                    let pieceRect = piece.getBoundingClientRect();
                    let relX = pieceRect.left - boardRect.left - 2; 
                    let relY = pieceRect.top - boardRect.top - 2;
                    let col = Math.round(relX / 40);
                    let row = Math.round(relY / 40);
                    
                    let canSnap = true;
                    let cellsToFill = [];
                    
                    if (col < 0 || row < 0 || col + mat[0].length > 6 || row + mat.length > 6) {
                        canSnap = false; 
                    } else {
                        for(let r=0; r<mat.length; r++) {
                            for(let c=0; c<mat[0].length; c++) {
                                if(mat[r][c]) {
                                    let br = row + r; let bc = col + c;
                                    if(window.boardState[br][bc] !== null) { canSnap = false; break; } 
                                    else { cellsToFill.push({r: br, c: bc}); }
                                }
                            }
                        }
                    }

                    if(canSnap) {
                        cellsToFill.forEach(cell => window.boardState[cell.r][cell.c] = idx);
                        piece.style.left = boardRect.left + 2 + col * 40 + 'px'; 
                        piece.style.top = boardRect.top + 2 + row * 40 + 'px';
                        piece.dataset.snapped = 'true'; piece.classList.add('snapped');
                        playSound('wood');
                        window.snappedCount++;
                        if(window.snappedCount === 9) setTimeout(() => alert('âœ¨ å®Œç¾çµ„åˆï¼å¼·è¿«ç—‡å®Œå…¨æ²»ç™’ï¼'), 400);
                    }
                });
            });
        }

        // --- æç¤ºç³»çµ± ---
        window.giveWoodHint = function() {
            if(window.hintIndex >= 9) return;
            let sol = solutionMap[window.hintIndex];
            let piece = document.querySelector(`.wood-piece[data-id='${sol.id}']`);
            if(!piece) return;
            
            // å°‡æ¬²æ”¾å…¥çš„æ–¹å¡Šè½‰æ­£
            piece.dataset.matrix = JSON.stringify(sol.mat);
            window.renderWoodMatrix(piece, sol.mat, sol.id);
            
            // æŠŠæ“‹è·¯çš„æ–¹å¡Šå…¨éƒ¨å¼·åˆ¶å½ˆå‡º
            for(let r=0; r<sol.mat.length; r++) {
                for(let c=0; c<sol.mat[0].length; c++) {
                    if(sol.mat[r][c]) {
                        let br = sol.r + r; let bc = sol.c + c;
                        let blockingId = window.boardState[br][bc];
                        if (blockingId !== null && blockingId !== sol.id) {
                            let blockP = document.querySelector(`.wood-piece[data-id='${blockingId}']`);
                            if (blockP) {
                                blockP.dataset.snapped = 'false'; blockP.classList.remove('snapped');
                                blockP.style.top = (Math.random() * 10 + 75) + '%';
                                blockP.style.left = (Math.random() * 60 + 10) + '%';
                                for(let rr=0; rr<6; rr++) {
                                    for(let cc=0; cc<6; cc++) { if(window.boardState[rr][cc] === blockingId) window.boardState[rr][cc] = null; }
                                }
                                window.snappedCount--;
                            }
                        }
                    }
                }
            }
            
            // æŠŠè‡ªå·±åŸä¾†çš„ä½”ç”¨æ ¼æ¸…ç©º
            if(piece.dataset.snapped === 'true') {
                for(let rr=0; rr<6; rr++) {
                    for(let cc=0; cc<6; cc++) { if(window.boardState[rr][cc] === sol.id) window.boardState[rr][cc] = null; }
                }
                window.snappedCount--;
            }

            // å®Œç¾å¸é™„
            let boardRect = document.getElementById('wood-board').getBoundingClientRect();
            piece.style.left = boardRect.left + 2 + sol.c * 40 + 'px';
            piece.style.top = boardRect.top + 2 + sol.r * 40 + 'px';
            piece.dataset.snapped = 'true';
            piece.classList.add('snapped');
            playSound('wood');
            
            for(let r=0; r<sol.mat.length; r++) {
                for(let c=0; c<sol.mat[0].length; c++) {
                    if(sol.mat[r][c]) window.boardState[sol.r + r][sol.c + c] = sol.id;
                }
            }
            window.snappedCount++;
            window.hintIndex++;
            if(window.snappedCount === 9) setTimeout(() => alert('âœ¨ å®Œç¾çµ„åˆï¼å¼·è¿«ç—‡å®Œå…¨æ²»ç™’ï¼'), 400);
        }

        // ==========================================
        // --- æ–°å¢ï¼š9. èª¿é…é¡æ–™ ---
        // ==========================================
        window.initWaterSortGame = function() {
            gameContent.innerHTML = `
                <div class="game-layout">
                    <p style="margin:0;font-weight:700;text-align:center;z-index:20;">é»æ“Šå…©å€‹ç“¶å­ä¾†å€’é¡æ–™ï¼Œè®“æ¯å€‹ç“¶å­é¡è‰²çµ±ä¸€ï¼</p>
                    <div class="bottles-container" id="bottles-container">
                        <div class="bottle-row" id="bottle-row-1"></div>
                        <div class="bottle-row" id="bottle-row-2"></div>
                    </div>
                    <button type="button" onpointerdown="event.stopPropagation(); restartGame(initWaterSortGame)" style="padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;z-index:20;">ğŸ”„ å†èª¿ä¸€æ‰¹</button>
                </div>
            `;
            
            const row1 = document.getElementById('bottle-row-1');
            const row2 = document.getElementById('bottle-row-2');
            
            const colors = ['#E63946', '#FFB5A7', '#F4A261', '#E9C46A', '#2A9D8F', '#4A8CD4', '#1D3557', '#9D4EDD', '#212529'];
            let pool = [];
            colors.forEach(c => { pool.push(c, c, c); });
            pool.sort(() => Math.random() - 0.5);

            let bottlesState = Array(10).fill().map(() => []);
            for(let i=0; i<6; i++) { bottlesState[i] = [pool.pop(), pool.pop(), pool.pop(), pool.pop()]; }
            bottlesState[6] = [pool.pop(), pool.pop(), pool.pop()];

            let selectedIdx = -1;

            function renderBottles() {
                row1.innerHTML = ''; row2.innerHTML = '';
                bottlesState.forEach((layers, idx) => {
                    let b = document.createElement('div');
                    b.className = 'bottle' + (selectedIdx === idx ? ' selected' : '');
                    layers.forEach(col => {
                        let l = document.createElement('div');
                        l.className = 'liquid-layer';
                        l.style.background = col;
                        b.appendChild(l);
                    });
                    
                    b.addEventListener('pointerdown', (e) => {
                        e.preventDefault(); 
                        if(Date.now() - window.gameStartTime < 500) return;
                        if(selectedIdx === -1) {
                            if(layers.length > 0) { selectedIdx = idx; renderBottles(); }
                        } else if(selectedIdx === idx) {
                            selectedIdx = -1; renderBottles();
                        } else {
                            let source = bottlesState[selectedIdx]; let target = bottlesState[idx];
                            // å–æ¶ˆåŒè‰²é™åˆ¶ï¼Œå–æ¶ˆæ™ºèƒ½å‚¾å€’ã€‚åªè¦æœ‰ç©ºé–“ï¼Œå°±èƒ½å€’ä¸€å±¤ï¼
                            if(source.length > 0 && target.length < 4) {
                                target.push(source.pop());
                                playSound('pour'); selectedIdx = -1; renderBottles(); checkWin();
                            } else {
                                selectedIdx = layers.length > 0 ? idx : -1; renderBottles();
                            }
                        }
                    });
                    if (idx < 5) row1.appendChild(b); else row2.appendChild(b);
                });
            }

            function checkWin() {
                let isWin = true;
                bottlesState.forEach(layers => {
                    if(layers.length > 0) {
                        if(layers.length !== 3) isWin = false; 
                        let firstCol = layers[0];
                        layers.forEach(c => { if(c !== firstCol) isWin = false; });
                    }
                });
                if(isWin) setTimeout(() => alert('âœ¨ é¡æ–™åˆ†é¡å¥½äº†ï¼çœ¼ç›æ²»ç™‚ï¼'), 400);
            }
            renderBottles();
        }

        // ==========================================
        // --- æ–°å¢ï¼š10. ç¢æ‰ç…©æƒ± (æ“´å¢50å¥ + åœ–å±¤å‹•ç•«ä¿®å¾©) ---
        // ==========================================
        const allWords = [
            'æ˜å¤©<br>æ˜ŸæœŸä¸€', 'é«”é‡<br>åˆè®Šé‡', 'è–ªæ°´<br>å»å“ªäº†', 'å®¢æˆ¶<br>é‚„æ²’å›', 'å°ˆæ¡ˆ<br>Delay',
            'è¨Šæ¯<br>è¢«å·²è®€', 'å¡è²»<br>ç¹³ä¸å‡ºä¾†', 'æˆ¿ç§Ÿ<br>å¿«åˆ°äº†', 'å ±å‘Š<br>é‚„æ²’å¯«', 'æ°¸é <br>ç¡ä¸é£½',
            'æ‰‹æ©Ÿ<br>æ²’é›»äº†', 'å¿˜è¨˜<br>å¸¶é‘°åŒ™', 'è¡£æœ<br>ç©¿ä¸ä¸‹', 'é ­é«®<br>ä¸€ç›´æ‰', 'è²·ä¸èµ·<br>æˆ¿å­',
            'æ™šé¤<br>åƒä»€éº¼', 'è‚¡ç¥¨<br>ä¸€ç›´è·Œ', 'çªç„¶<br>ä¸‹å¤§é›¨', 'è¸©åˆ°<br>ç‹—å¤§ä¾¿', 'é¦¬æ¡¶<br>å¡ä½äº†',
            'å‡ºé–€<br>å¿˜è¨˜å¸¶å‚˜', 'æ·é‹<br>è·‘æ‰äº†', 'é¬§é˜<br>æ²’éŸ¿', 'é›»è…¦<br>ç•¶æ©Ÿäº†', 'æª”æ¡ˆ<br>æ²’å­˜æª”',
            'ä¸»ç®¡<br>åˆæ‰¾æˆ‘', 'æœƒè­°<br>é–‹ä¸å®Œ', 'KPI<br>æ²’é”æ¨™', 'åŒäº‹<br>ç‹‚ç”©é‹', 'åŠ ç­<br>æ²’éŒ¢æ‹¿',
            'æƒ³åƒ<br>é¹½é…¥é›', 'é£²æ–™<br>å»å†°åŠç³–', 'çç <br>è³£å®Œäº†', 'ä¾¿ç•¶<br>åˆæ¼²åƒ¹', 'æœˆåº•<br>åƒæ³¡éºµ',
            'æ‰¾ä¸åˆ°<br>é™æ§å™¨', 'è€³æ©Ÿ<br>å‰©ä¸€é‚Š', 'ç¶²é€Ÿ<br>æœ‰å¤ æ…¢', 'å½±ç‰‡<br>ä¸€ç›´è½‰åœˆ', 'åŒ…è£¹<br>é‚„æ²’ä¾†',
            'æŠ½å¡<br>åˆä¿åº•', 'éŠæˆ²<br>ç‹‚æ–·ç·š', 'é‡åˆ°<br>é›·éšŠå‹', 'å†·æ°£<br>ä¸å¤ å†·', 'èšŠå­<br>æ‰“ä¸åˆ°',
            'æ´—æ¾¡<br>æ²’ç†±æ°´', 'åƒåœ¾<br>å¿˜è¨˜å€’', 'è¡£æœ<br>é‚„æ²’æ´—', 'åˆè¦<br>å¤§æƒé™¤', 'åªæƒ³<br>èººå¹³'
        ];

        window.initShredderGame = function() {
            gameContent.innerHTML = `
                <div class="game-layout">
                    <p style="margin:0;font-weight:700;text-align:center;z-index:20;">æŠŠç…©æƒ±æ‹–é€²ç¢ç´™æ©Ÿè£¡çµç¢å§ï¼</p>
                    
                    <div class="shredder-stage" id="shred-stage">
                        <div class="shredder-back"></div>
                        <div class="shredder-slot" id="shred-slot"></div>
                        <div class="shredder-bin"></div>
                        <div class="shredder-front"></div>
                    </div>

                    <button type="button" onpointerdown="event.stopPropagation(); restartGame(initShredderGame)" style="padding:10px 20px;border-radius:15px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;z-index:20;">ğŸ”„ æ›ä¸€æ‰¹ç…©æƒ±</button>
                    <div class="papers-container" id="papers-container"></div>
                </div>
            `;
            
            const container = document.getElementById('papers-container');
            const slot = document.getElementById('shred-slot');
            const stage = document.getElementById('shred-stage');
            
            // éš¨æ©Ÿé¸å‡º 5 å€‹ç…©æƒ±
            let words = [...allWords].sort(() => Math.random() - 0.5).slice(0, 5);
            let shredCount = 0;

            words.forEach((word, i) => {
                let paper = document.createElement('div');
                paper.className = 'draggable-paper';
                paper.dataset.snapped = 'false';
                paper.innerHTML = `<span class="paper-text">${word}</span>`;
                
                paper.style.left = (Math.random() * 60 + 10) + '%';
                paper.style.top = (Math.random() * 20 + 5) + '%';
                paper.style.transform = `rotate(${(Math.random() - 0.5) * 30}deg)`;
                
                container.appendChild(paper);
                
                let isDragging = false, hasMoved = false, offsetX, offsetY, startX, startY;

                paper.addEventListener('touchstart', e => {
                    if(Date.now() - window.gameStartTime < 500 || paper.dataset.snapped === 'true') return;
                    isDragging = true; hasMoved = false; 
                    let touch = e.touches[0]; startX = touch.clientX; startY = touch.clientY;
                    let rect = paper.getBoundingClientRect(); offsetX = touch.clientX - rect.left; offsetY = touch.clientY - rect.top; 
                    paper.style.zIndex = 60; 
                });

                paper.addEventListener('touchmove', e => {
                    if(!isDragging) return; 
                    let touch = e.touches[0];
                    if (Math.abs(touch.clientX - startX) > 10 || Math.abs(touch.clientY - startY) > 10) hasMoved = true;
                    paper.style.position = 'fixed'; paper.style.left = (touch.clientX - offsetX) + 'px'; paper.style.top = (touch.clientY - offsetY) + 'px'; e.preventDefault();
                }, {passive: false});

                paper.addEventListener('touchend', e => {
                    if(!isDragging) return; isDragging = false; paper.style.zIndex = '55';
                    if(!hasMoved) return; 
                    
                    let slotRect = slot.getBoundingClientRect();
                    let paperRect = paper.getBoundingClientRect();

                    let isAlignY = Math.abs(paperRect.bottom - slotRect.top) < 30; 
                    let isAlignX = paperRect.right > slotRect.left + 10 && paperRect.left < slotRect.right - 10;

                    if (isAlignY && isAlignX) {
                        paper.dataset.snapped = 'true'; 
                        
                        stage.appendChild(paper);
                        paper.style.position = 'absolute';
                        let stageRect = stage.getBoundingClientRect();
                        
                        paper.style.left = (slotRect.left - stageRect.left + slotRect.width/2 - paper.offsetWidth/2) + 'px';
                        paper.style.top = (slotRect.top - stageRect.top - paper.offsetHeight + 6) + 'px'; 
                        paper.style.transform = 'none';
                        paper.style.zIndex = '10'; 
                        
                        setTimeout(() => {
                            paper.classList.add('shred-paper-anim');
                            playSound('shred');
                            
                            let strips = document.createElement('div');
                            strips.className = 'shred-strips-anim';
                            strips.style.left = paper.style.left;
                            strips.style.top = (slotRect.bottom - stageRect.top) + 'px'; 
                            strips.innerHTML = '<div class="stripe"></div>'.repeat(8);
                            stage.appendChild(strips);

                        }, 50);

                        shredCount++;
                        if(shredCount === words.length) setTimeout(() => alert('âœ¨ ç…©æƒ±å…¨ç¢å…‰äº†ï¼å¿ƒæƒ…å¤§å¥½ï¼'), 1800);
                    }
                });
            });
        }
    </script>
</body>
</html>
